---
title: "HADACA3 Framework Benchamrk between Snakemake and Nextflow"
subtitle: "Meta analysis"
author: ""
date: "`r Sys.Date()`"
output: 
  rmarkdown::html_document:
    toc: true
    toc_float: true
    toc_depth: 3
    number_sections: true
---

```{r, echo=FALSE, eval=TRUE}
knitr::opts_chunk$set(collapse=TRUE, comment = "#>", fig.width=12, fig.height=12, eval=TRUE, echo=TRUE, results="verbatim", dpi=75)
```

```{r loading_pckgs}
# Load necessary library
library(ggplot2)
library(dplyr)
library(tidyr)
```


# display number of jobs for each setup

```{r}

data <- data.frame(
  job = rep(c(
    "cleaning_mix", "cleaning_ref", "features_selection", "late_integration",
    "metaanalysis", "prediction_deconvolution_met", "prediction_deconvolution_rna",
    "preprocessing", "scoring"
  ), times = 10),
  setup = rep(paste0("setup", 1:10), each = 9),
  count = c(
    # setup1
    1, 1, 5, 4, 1, 2, 2, 5, 4,
    # setup2
    2, 1, 7, 8, 1, 4, 4, 7, 8,
    # setup3
    4, 1, 11, 16, 1, 8, 8, 11, 16,
    # setup4
    2, 1, 16, 128, 1, 64, 4, 10, 128,
    # setup5
    2, 1, 16, 384, 1, 64, 4, 10, 384,
    # setup6
    2, 1, 16, 512, 1, 64, 4, 10, 512,
    # setup7
    2, 1, 26, 4608, 1, 96, 96, 13, 4608,
    # setup8
    2, 1, 33, 10368, 1, 216, 96, 13, 10368,
    # setup9
    2, 1, 33, 31104, 1, 216, 96, 13, 31104,
    # setup10
    2, 1, 33, 62208, 1, 216, 96, 13, 62208
  )
)
data$setup <- factor(data$setup, levels = paste0("setup", 1:10))

```



## With linear scale. 
```{r, eval = FALSE}
# Plot the bar chart
ggplot(data, aes(x = job, y = count, fill = setup)) +
  geom_bar(stat = "identity", position = position_dodge()) +
  labs(title = "Job Counts by Setup", x = "Job", y = "Count") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

## With log scale
```{r}
ggplot(data, aes(x = setup, y = count, fill = job)) +
  geom_bar(stat = "identity") +
  labs(title = "Job Counts by Setup", x = "Setup", y = "Count") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

```{r}
# Plot the stacked bar chart
ggplot(data, aes(x = setup, y = count, fill = job)) +
  geom_bar(stat = "identity") +
  scale_y_log10() + 
  labs(title = "Job Counts by Setup", x = "Setup", y = "Count") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```


# Parse result and plot

```{r}
file_path <- paste0("results/data.txt")  # Replace with the actual file path
data <- readLines(file_path)
filtered_data <- data[grepl("^\\w+\\s*:\\s*\\([0-9.]+,[0-9.]+\\)$", data)]

# Parse the data
parsed_data <- data.frame(
  line = filtered_data,
  stringsAsFactors = FALSE
) %>%
  mutate(
    workflow = sub(" .*", "", line),
    values = sub(".* : \\(", "", line),
      values = sub("\\)", "", values),
    time = as.numeric(sub(",.*", "", values)),
    memory = as.numeric(sub(".*?,", "", values)),
    setup = as.numeric(sub("\\D+", "", workflow)),
    workflow= sub("\\d","",workflow)
  ) %>%
  select(setup, workflow, time, memory)

# # Create plots
ggplot(parsed_data, aes(x = setup, y = time, group = workflow, color = workflow)) +
  geom_line() +
  geom_point() +
  labs(title = "Time (seconds) vs Setup", x = "Setup", y = "Time (seconds)") +
  theme_minimal()

ggplot(parsed_data, aes(x = setup, y = memory, group = workflow, color = workflow)) +
  geom_line() +
  geom_point() +
  labs(title = "Memory vs Setup", x = "Setup", y = "Memory") +
  theme_minimal()


```













