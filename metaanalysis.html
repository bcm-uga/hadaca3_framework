<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />


<meta name="author" content="" />

<meta name="date" content="2026-01-28" />

<title>HADACA3 Framework - Generate data for data challenge hadaca</title>

<script src="08_metaanalysis_files/header-attrs-2.29/header-attrs.js"></script>
<script src="08_metaanalysis_files/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="08_metaanalysis_files/bootstrap-3.3.5/css/bootstrap.min.css" rel="stylesheet" />
<script src="08_metaanalysis_files/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="08_metaanalysis_files/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="08_metaanalysis_files/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="08_metaanalysis_files/jqueryui-1.13.2/jquery-ui.min.js"></script>
<link href="08_metaanalysis_files/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="08_metaanalysis_files/tocify-1.9.1/jquery.tocify.js"></script>
<script src="08_metaanalysis_files/navigation-1.1/tabsets.js"></script>
<link href="08_metaanalysis_files/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="08_metaanalysis_files/highlightjs-9.12.0/highlight.js"></script>
<link href="08_metaanalysis_files/htmltools-fill-0.5.8.1/fill.css" rel="stylesheet" />
<script src="08_metaanalysis_files/htmlwidgets-1.6.4/htmlwidgets.js"></script>
<link href="08_metaanalysis_files/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet" />
<script src="08_metaanalysis_files/datatables-binding-0.33/datatables.js"></script>
<link href="08_metaanalysis_files/dt-core-1.13.6/css/jquery.dataTables.min.css" rel="stylesheet" />
<link href="08_metaanalysis_files/dt-core-1.13.6/css/jquery.dataTables.extra.css" rel="stylesheet" />
<script src="08_metaanalysis_files/dt-core-1.13.6/js/jquery.dataTables.min.js"></script>
<link href="08_metaanalysis_files/crosstalk-1.2.1/css/crosstalk.min.css" rel="stylesheet" />
<script src="08_metaanalysis_files/crosstalk-1.2.1/js/crosstalk.min.js"></script>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>

<style type="text/css">code{white-space: pre;}</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>









<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
details > summary > p:only-child {
  display: inline;
}
pre code {
  padding: 0;
}
</style>



<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before, .tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "\e259";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "\e258";
  font-family: 'Glyphicons Halflings';
  border: none;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div id="header">



<h1 class="title toc-ignore">HADACA3 Framework - Generate data for data
challenge hadaca</h1>
<h3 class="subtitle">Meta analysis</h3>
<h4 class="author"></h4>
<h4 class="date">2026-01-28</h4>

</div>


<pre class="r"><code>


# results_li_csv_file = get(&quot;results_li&quot;)
if(!exists(&quot;results_li&quot;)){
  print(&quot;reading reulsts li csv&quot;)
  
  all_functions_li &lt;- c(
    &#39;preprocessing_mixRNA&#39;, &#39;feature_selection_mixRNA&#39;,
    &#39;preprocessing_RNA&#39;, &#39;feature_selection_RNA&#39;,
    &#39;preprocessing_scRNA&#39;, &#39;feature_selection_scRNA&#39;, &#39;deconvolution_rna&#39;,
    &#39;preprocessing_mixMET&#39;, &#39;feature_selection_mixMET&#39;,
    &#39;preprocessing_MET&#39;, &#39;feature_selection_MET&#39;, &#39;deconvolution_met&#39;,
    &#39;late_integration&#39;
  )
  results_li_csv_file &lt;- list.files(
    pattern = &quot;^results_li.*\\.csv.gz$&quot;
  )
  results_li = read.csv(file = gzfile(results_li_csv_file )) # &quot;results_li.csv.gz&quot;))
  results_li[all_functions_li] &lt;- lapply(results_li[all_functions_li], as.factor)
}


# results_li_csv_file = get()
if(!exists(&quot;results_ei&quot;)){
  print(&quot;reading reulsts ei csv&quot;)
  
  all_functions_ei &lt;- c(
    &#39;preprocessing_mixRNA&#39;, &#39;feature_selection_mixRNA&#39;,
    &#39;preprocessing_RNA&#39;, &#39;feature_selection_RNA&#39;,
    &#39;preprocessing_scRNA&#39;, &#39;feature_selection_scRNA&#39;,
    &#39;preprocessing_mixMET&#39;, &#39;feature_selection_mixMET&#39;,
    &#39;preprocessing_MET&#39;, &#39;feature_selection_MET&#39;,
    &#39;early_integration&#39;, &#39;deconvolution&#39;
  )
  
  file_name_ei_csv &lt;- list.files(
    pattern = &quot;^results_ei.*\\.csv.gz$&quot;
  )
  results_ei = read.csv(file = gzfile(file_name_ei_csv))#&quot;results_ei.csv.gz&quot;))
  if(length(results_ei)&gt;1 ){
    results_ei[all_functions_ei] &lt;- lapply(results_ei[all_functions_ei], as.factor)
  }
}</code></pre>
<div id="top-methods" class="section level1" number="1">
<h1><span class="header-section-number">1</span> Top methods</h1>
<div id="overall-top-10-method-by-median-of-the-aggregated-score"
class="section level2" number="1.1">
<h2><span class="header-section-number">1.1</span> Overall top 10 method
by median of the aggregated score</h2>
<pre class="r"><code>results_li_top10 = results_li %&gt;%
  group_by(preprocessing_mixRNA, feature_selection_mixRNA, 
           preprocessing_RNA, feature_selection_RNA, 
           preprocessing_scRNA, feature_selection_scRNA, deconvolution_rna, 
           preprocessing_mixMET,feature_selection_mixMET, 
           preprocessing_MET, feature_selection_MET, deconvolution_met, 
           late_integration, .groups = &quot;keep&quot;) %&gt;% 
  summarise(GlobalScore = median(score_aggreg)) %&gt;%
  arrange(desc(GlobalScore))

datatable(results_li_top10[1:10,-c(14)])</code></pre>
<div class="datatables html-widget html-fill-item" id="htmlwidget-a5f3d27409f966a38b59" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-a5f3d27409f966a38b59">{"x":{"filter":"none","vertical":false,"data":[["1","2","3","4","5","6","7","8","9","10"],["Scale","Scale","LogNorm","LogNorm","Scale","Scale","Scale","Scale","Scale","Scale"],["scSPLSDA","scSPLSDA","scSPLSDA","scSPLSDA","scSPLSDA","scSPLSDA","scSPLSDA","scSPLSDA","fsID","fsID"],["Scale","Scale","LogNorm","LogNorm","Scale","Scale","Scale","Scale","Scale","Scale"],["scSPLSDA","scSPLSDA","scSPLSDA","scSPLSDA","scSPLSDA","scSPLSDA","scSPLSDA","scSPLSDA","fsID","fsID"],["sccluster","sccluster","sccluster","sccluster","sccluster","sccluster","sccluster","sccluster","LogNorm","LogNorm"],["scSPLSDA","scpseudobulk","scSPLSDA","scpseudobulk","scSPLSDA","scSPLSDA","scpseudobulk","scpseudobulk","Toastvst","fsID"],["RLRpoisson","RLRpoisson","RLRpoisson","RLRpoisson","RLRpoisson","RLRpoisson","RLRpoisson","RLRpoisson","RLRpoisson","RLRpoisson"],["ppID","ppID","ppID","ppID","Scale","LogNorm","Scale","LogNorm","ppID","ppID"],["fsID","fsID","fsID","fsID","fsID","fsID","fsID","fsID","fsID","fsID"],["ppID","ppID","ppID","ppID","Scale","LogNorm","Scale","LogNorm","ppID","ppID"],["fsID","fsID","fsID","fsID","fsID","fsID","fsID","fsID","fsID","fsID"],["RLR","RLR","RLR","RLR","RLR","RLR","RLR","RLR","RLR","RLR"],["limean","limean","limean","limean","limean","limean","limean","limean","limean","limean"],[0.7327388250535909,0.7327388250535909,0.7299011925684509,0.7299011925684509,0.7298996032759479,0.7298996032759479,0.7298996032759479,0.7298996032759479,0.7295703327383538,0.7295703327383538]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>preprocessing_mixRNA<\/th>\n      <th>feature_selection_mixRNA<\/th>\n      <th>preprocessing_RNA<\/th>\n      <th>feature_selection_RNA<\/th>\n      <th>preprocessing_scRNA<\/th>\n      <th>feature_selection_scRNA<\/th>\n      <th>deconvolution_rna<\/th>\n      <th>preprocessing_mixMET<\/th>\n      <th>feature_selection_mixMET<\/th>\n      <th>preprocessing_MET<\/th>\n      <th>feature_selection_MET<\/th>\n      <th>deconvolution_met<\/th>\n      <th>late_integration<\/th>\n      <th>GlobalScore<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":14},{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"preprocessing_mixRNA","targets":1},{"name":"feature_selection_mixRNA","targets":2},{"name":"preprocessing_RNA","targets":3},{"name":"feature_selection_RNA","targets":4},{"name":"preprocessing_scRNA","targets":5},{"name":"feature_selection_scRNA","targets":6},{"name":"deconvolution_rna","targets":7},{"name":"preprocessing_mixMET","targets":8},{"name":"feature_selection_mixMET","targets":9},{"name":"preprocessing_MET","targets":10},{"name":"feature_selection_MET","targets":11},{"name":"deconvolution_met","targets":12},{"name":"late_integration","targets":13},{"name":"GlobalScore","targets":14}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
<div id="by-variables" class="section level2" number="1.2">
<h2><span class="header-section-number">1.2</span> By variables</h2>
<pre class="r"><code>arranged_boxplot = function(data, x_var, score = &quot;score_aggreg&quot;){
  
  if (x_var != &quot;early_integration&quot; &amp;&amp; x_var != &quot;late_integration&quot;) {
    data = data[data$preprocessing_mixRNA != &quot;nopp&quot;,]
    data = data[data$feature_selection_mixRNA != &quot;nofs&quot;,]
    data = data[data$preprocessing_RNA != &quot;nopp&quot;,]
    data = data[data$feature_selection_RNA != &quot;nofs&quot;,]
    data = data[data$preprocessing_scRNA != &quot;nopp&quot;,]
    data = data[data$feature_selection_scRNA != &quot;nofs&quot;,]
    data = data[data$deconvolution_rna != &quot;node&quot;,]
    data = data[data$preprocessing_mixMET != &quot;nopp&quot;,]
    data = data[data$feature_selection_mixMET != &quot;nofs&quot;,]
    data = data[data$preprocessing_MET != &quot;nopp&quot;,]
    data = data[data$feature_selection_MET != &quot;nofs&quot;,]
    data = data[data$deconvolution_met != &quot;node&quot;,]
  }
  
  order_level_x_var = sapply(levels(data[,x_var]), \(level_i){
    median(data[data[,x_var] == level_i, score])
  })
  order_level_x_var = order_level_x_var[order(order_level_x_var, decreasing = TRUE)]
  data[,x_var] = factor(data[,x_var], levels = names(order_level_x_var))
  
  
  aes_base = aes_string(x = x_var, y = score)
  ggplot(data[,c(x_var, score)]) +
    # geom_boxplot(aes_base) +
    geom_violin(aes_base, draw_quantiles = 0.5) +
    labs(
      title = paste(&quot;Aggregated score for&quot;, x_var),
      subtitle = &quot;ordered by median of aggregated score (horizontal line)&quot;,
      x = element_blank(),
      y = &quot;Aggregated score&quot;,
    ) +
    theme(
      axis.text.x = element_text(angle = 45, hjust = 1, size = 8),
      panel.border = element_rect(color = &quot;black&quot;, fill = NA, linewidth = 0.5),
      plot.title = element_text(hjust = 0.5),
      plot.subtitle = element_text(hjust = 0.5),
      legend.position = &quot;bottom&quot;
    )
}


arranged_boxplot(data = results_li, x_var = all_functions_li[1])</code></pre>
<p><img src="08_metaanalysis_files/figure-html/fun_arranged_boxplot-1.png" width="900" /></p>
<pre class="r"><code>arranged_boxplot(data = results_li, x_var = all_functions_li[2])</code></pre>
<p><img src="08_metaanalysis_files/figure-html/fun_arranged_boxplot-2.png" width="900" /></p>
<pre class="r"><code>arranged_boxplot(data = results_li, x_var = all_functions_li[3])</code></pre>
<p><img src="08_metaanalysis_files/figure-html/fun_arranged_boxplot-3.png" width="900" /></p>
<pre class="r"><code>arranged_boxplot(data = results_li, x_var = all_functions_li[4])</code></pre>
<p><img src="08_metaanalysis_files/figure-html/fun_arranged_boxplot-4.png" width="900" /></p>
<pre class="r"><code>arranged_boxplot(data = results_li, x_var = all_functions_li[5])</code></pre>
<p><img src="08_metaanalysis_files/figure-html/fun_arranged_boxplot-5.png" width="900" /></p>
<pre class="r"><code>arranged_boxplot(data = results_li, x_var = all_functions_li[6])</code></pre>
<p><img src="08_metaanalysis_files/figure-html/fun_arranged_boxplot-6.png" width="900" /></p>
<pre class="r"><code>arranged_boxplot(data = results_li, x_var = all_functions_li[7])</code></pre>
<p><img src="08_metaanalysis_files/figure-html/fun_arranged_boxplot-7.png" width="900" /></p>
<pre class="r"><code>arranged_boxplot(data = results_li, x_var = all_functions_li[8])</code></pre>
<p><img src="08_metaanalysis_files/figure-html/fun_arranged_boxplot-8.png" width="900" /></p>
<pre class="r"><code>arranged_boxplot(data = results_li, x_var = all_functions_li[9])</code></pre>
<p><img src="08_metaanalysis_files/figure-html/fun_arranged_boxplot-9.png" width="900" /></p>
<pre class="r"><code>arranged_boxplot(data = results_li, x_var = all_functions_li[10])</code></pre>
<p><img src="08_metaanalysis_files/figure-html/fun_arranged_boxplot-10.png" width="900" /></p>
<pre class="r"><code>arranged_boxplot(data = results_li, x_var = all_functions_li[11])</code></pre>
<p><img src="08_metaanalysis_files/figure-html/fun_arranged_boxplot-11.png" width="900" /></p>
<pre class="r"><code>arranged_boxplot(data = results_li, x_var = all_functions_li[12])</code></pre>
<p><img src="08_metaanalysis_files/figure-html/fun_arranged_boxplot-12.png" width="900" /></p>
<pre class="r"><code>arranged_boxplot(data = results_li, x_var = all_functions_li[13])</code></pre>
<p><img src="08_metaanalysis_files/figure-html/fun_arranged_boxplot-13.png" width="900" /></p>
</div>
</div>
<div id="correlations-of-the-different-metrics" class="section level1"
number="2">
<h1><span class="header-section-number">2</span> Correlations of the
different metrics</h1>
<pre class="r"><code>
# Fonction personnalisée pour corrélations avec couleurs et légende
cor_fun_colored &lt;- function(data, mapping, method = &quot;pearson&quot;, ndp = 2, sz = 4, ...) {
  x &lt;- eval_data_col(data, mapping$x)
  y &lt;- eval_data_col(data, mapping$y)
  corr &lt;- cor(x, y, method = method, use = &quot;complete.obs&quot;)
  
  # Palette de couleurs continue de -1 à 1
  # Utilisation d&#39;une palette divergente : bleu (négatif) - blanc (0) - rouge (positif)
  color_palette &lt;- colorRampPalette(c(&quot;#2166AC&quot;, &quot;#F7F7F7&quot;, &quot;#B2182B&quot;))(100)
  color_index &lt;- round((corr + 1) * 50) + 1  # Convertit [-1,1] en [1,100]
  color_index &lt;- pmax(1, pmin(100, color_index))  # Assure que l&#39;index est dans [1,100]
  col_cor &lt;- color_palette[color_index]
  
  ggally_text(label = paste0(&quot;Corr &quot;, method, &quot; :\n&quot;, round(corr, ndp)), 
              color = col_cor, 
              size = sz,
              fontface = &quot;bold&quot;) +
    theme_void()
}

density_fun_limited &lt;- function(data, mapping, ...) {
  ggplot(data = data, mapping = mapping) +
    geom_density2d(alpha = 0.6, color = &quot;steelblue&quot;, ...) +
    xlim(0, 1) +
    ylim(0, 1)
}

# Version finale optimisée
ggpairs_final &lt;- ggpairs(
  results_li,  # Dataset complet
  columns = c(&quot;score_aggreg&quot;, &quot;rmse_norm&quot;, &quot;pearson_col_norm&quot;, &quot;spearman_col_norm&quot;, &quot;aid_norm&quot;, &quot;jsd_norm&quot;),
  upper = list(continuous = cor_fun_colored),
  lower = list(continuous = density_fun_limited),
  # lower = list(continuous = wrap(&quot;density&quot;, alpha = 0.6, bins = 10, fill = &quot;steelblue&quot;, xlim = c(0,1), ylim = c(0,1))),
  diag = list(continuous = wrap(&quot;densityDiag&quot;, alpha = 0.8, fill = &quot;lightblue&quot;))
) + 
theme(
  strip.text = element_text(size = 10, face = &quot;bold&quot;),
  axis.text = element_text(size = 8)
)

print(ggpairs_final)
#&gt; Warning: Removed 2592 rows containing non-finite outside the scale range
#&gt; (`stat_density2d()`).
#&gt; Warning: Removed 2592 rows containing non-finite outside the scale range
#&gt; (`stat_density()`).
#&gt; Warning: Removed 2592 rows containing non-finite outside the scale range
#&gt; (`stat_density2d()`).
#&gt; Removed 2592 rows containing non-finite outside the scale range
#&gt; (`stat_density2d()`).
#&gt; Warning: Removed 2592 rows containing non-finite outside the scale range
#&gt; (`stat_density()`).
#&gt; Warning: Removed 2592 rows containing non-finite outside the scale range
#&gt; (`stat_density2d()`).
#&gt; Removed 2592 rows containing non-finite outside the scale range
#&gt; (`stat_density2d()`).
#&gt; Removed 2592 rows containing non-finite outside the scale range
#&gt; (`stat_density2d()`).
#&gt; Warning: Removed 2592 rows containing non-finite outside the scale range
#&gt; (`stat_density()`).
#&gt; Warning: Removed 2592 rows containing non-finite outside the scale range
#&gt; (`stat_density2d()`).
#&gt; Removed 2592 rows containing non-finite outside the scale range
#&gt; (`stat_density2d()`).
#&gt; Removed 2592 rows containing non-finite outside the scale range
#&gt; (`stat_density2d()`).
#&gt; Removed 2592 rows containing non-finite outside the scale range
#&gt; (`stat_density2d()`).
#&gt; Warning: Removed 2592 rows containing non-finite outside the scale range
#&gt; (`stat_density()`).
#&gt; Warning: Removed 7776 rows containing non-finite outside the scale range
#&gt; (`stat_density2d()`).
#&gt; Removed 7776 rows containing non-finite outside the scale range
#&gt; (`stat_density2d()`).
#&gt; Removed 7776 rows containing non-finite outside the scale range
#&gt; (`stat_density2d()`).
#&gt; Removed 7776 rows containing non-finite outside the scale range
#&gt; (`stat_density2d()`).
#&gt; Removed 7776 rows containing non-finite outside the scale range
#&gt; (`stat_density2d()`).
#&gt; Warning: Removed 7776 rows containing non-finite outside the scale range
#&gt; (`stat_density()`).</code></pre>
<p><img src="08_metaanalysis_files/figure-html/cor_dens_plot-1.png" width="900" /></p>
<ul>
<li>Corrélations élevées</li>
<li>distribution marginales proches</li>
</ul>
<pre class="r"><code># results_li[results_li==&quot;NaN&quot;] = NA
row_rm = apply(results_li,1,function(x) any(is.na(x)))
results_li_rm = results_li[!row_rm,-(1:(length(all_functions_li)+2))]

score_aggreg_order = grep(&quot;score_aggreg&quot;, colnames(results_li_rm))
normalised_metrics = grep(&quot;norm&quot;, colnames(results_li_rm))
unnormalised_metrics = (1:ncol(results_li_rm))[-c(score_aggreg_order, normalised_metrics)]
corr_metric = c(grep(&quot;pearson&quot;, colnames(results_li_rm)), grep(&quot;spearman&quot;, colnames(results_li_rm)))

correlations = cor(results_li_rm[,c(
  score_aggreg_order, 
  normalised_metrics[!(normalised_metrics %in% corr_metric)], 
  normalised_metrics[normalised_metrics %in% corr_metric], 
  unnormalised_metrics[!(unnormalised_metrics %in% corr_metric)],
  unnormalised_metrics[unnormalised_metrics %in% corr_metric]
)])
corrplot::corrplot(correlations, method=&#39;ellipse&#39;, type=&#39;full&#39;, outline=T, tl.col=&#39;black&#39;)</code></pre>
<p><img src="08_metaanalysis_files/figure-html/cor_plot-1.png" width="900" /></p>
<ul>
<li>Aitchison et pearson row (type cell) sont les plus différentiables.
Le premiers est cependant du à des limites techniques (valeurs
exponentielles lorsque proportions proches de 0).</li>
<li>corrélations élevées -&gt; metriques d’angles proche de RMSE et
MAE</li>
</ul>
</div>
<div id="florent-stepwise-model" class="section level1" number="3">
<h1><span class="header-section-number">3</span> Florent stepwise
model</h1>
<pre class="r"><code>foo = sapply(names(results_li), function(k) {
  print(k)
  main = k
  if (is.character(results_li[,k]) || is.factor(results_li[,k])) {
    barplot(table(results_li[,k], useNA=&quot;always&quot;), las=2, main=main)
    return(&quot;char&quot;)
k  } else if (is.numeric(results_li[,k])){
      plot(density(results_li[,k], na.rm=TRUE), main=main)
      print(paste0(&quot;#NA: &quot;, sum(is.na(results_li[,k]))))
    return(&quot;num&quot;)
  } else {
    stop(paste0(&quot;Data type not treated: &quot;, k))
  }
})
#&gt; [1] &quot;dataset&quot;</code></pre>
<p><img src="08_metaanalysis_files/figure-html/stepwise_model-1.png" width="900" /></p>
<pre><code>#&gt; [1] &quot;ref&quot;</code></pre>
<p><img src="08_metaanalysis_files/figure-html/stepwise_model-2.png" width="900" /></p>
<pre><code>#&gt; [1] &quot;preprocessing_mixRNA&quot;</code></pre>
<p><img src="08_metaanalysis_files/figure-html/stepwise_model-3.png" width="900" /></p>
<pre><code>#&gt; [1] &quot;feature_selection_mixRNA&quot;</code></pre>
<p><img src="08_metaanalysis_files/figure-html/stepwise_model-4.png" width="900" /></p>
<pre><code>#&gt; [1] &quot;preprocessing_RNA&quot;</code></pre>
<p><img src="08_metaanalysis_files/figure-html/stepwise_model-5.png" width="900" /></p>
<pre><code>#&gt; [1] &quot;feature_selection_RNA&quot;</code></pre>
<p><img src="08_metaanalysis_files/figure-html/stepwise_model-6.png" width="900" /></p>
<pre><code>#&gt; [1] &quot;preprocessing_scRNA&quot;</code></pre>
<p><img src="08_metaanalysis_files/figure-html/stepwise_model-7.png" width="900" /></p>
<pre><code>#&gt; [1] &quot;feature_selection_scRNA&quot;</code></pre>
<p><img src="08_metaanalysis_files/figure-html/stepwise_model-8.png" width="900" /></p>
<pre><code>#&gt; [1] &quot;deconvolution_rna&quot;</code></pre>
<p><img src="08_metaanalysis_files/figure-html/stepwise_model-9.png" width="900" /></p>
<pre><code>#&gt; [1] &quot;preprocessing_mixMET&quot;</code></pre>
<p><img src="08_metaanalysis_files/figure-html/stepwise_model-10.png" width="900" /></p>
<pre><code>#&gt; [1] &quot;feature_selection_mixMET&quot;</code></pre>
<p><img src="08_metaanalysis_files/figure-html/stepwise_model-11.png" width="900" /></p>
<pre><code>#&gt; [1] &quot;preprocessing_MET&quot;</code></pre>
<p><img src="08_metaanalysis_files/figure-html/stepwise_model-12.png" width="900" /></p>
<pre><code>#&gt; [1] &quot;feature_selection_MET&quot;</code></pre>
<p><img src="08_metaanalysis_files/figure-html/stepwise_model-13.png" width="900" /></p>
<pre><code>#&gt; [1] &quot;deconvolution_met&quot;</code></pre>
<p><img src="08_metaanalysis_files/figure-html/stepwise_model-14.png" width="900" /></p>
<pre><code>#&gt; [1] &quot;late_integration&quot;</code></pre>
<p><img src="08_metaanalysis_files/figure-html/stepwise_model-15.png" width="900" /></p>
<pre><code>#&gt; [1] &quot;aid&quot;</code></pre>
<p><img src="08_metaanalysis_files/figure-html/stepwise_model-16.png" width="900" /></p>
<pre><code>#&gt; [1] &quot;#NA: 2592&quot;
#&gt; [1] &quot;aid_norm&quot;</code></pre>
<p><img src="08_metaanalysis_files/figure-html/stepwise_model-17.png" width="900" /></p>
<pre><code>#&gt; [1] &quot;#NA: 2592&quot;
#&gt; [1] &quot;aitchison&quot;</code></pre>
<p><img src="08_metaanalysis_files/figure-html/stepwise_model-18.png" width="900" /></p>
<pre><code>#&gt; [1] &quot;#NA: 2592&quot;
#&gt; [1] &quot;aitchison_norm&quot;</code></pre>
<p><img src="08_metaanalysis_files/figure-html/stepwise_model-19.png" width="900" /></p>
<pre><code>#&gt; [1] &quot;#NA: 2592&quot;
#&gt; [1] &quot;jsd&quot;</code></pre>
<p><img src="08_metaanalysis_files/figure-html/stepwise_model-20.png" width="900" /></p>
<pre><code>#&gt; [1] &quot;#NA: 7776&quot;
#&gt; [1] &quot;jsd_norm&quot;</code></pre>
<p><img src="08_metaanalysis_files/figure-html/stepwise_model-21.png" width="900" /></p>
<pre><code>#&gt; [1] &quot;#NA: 7776&quot;
#&gt; [1] &quot;mae&quot;</code></pre>
<p><img src="08_metaanalysis_files/figure-html/stepwise_model-22.png" width="900" /></p>
<pre><code>#&gt; [1] &quot;#NA: 2592&quot;
#&gt; [1] &quot;mae_norm&quot;</code></pre>
<p><img src="08_metaanalysis_files/figure-html/stepwise_model-23.png" width="900" /></p>
<pre><code>#&gt; [1] &quot;#NA: 2592&quot;
#&gt; [1] &quot;pearson_col&quot;</code></pre>
<p><img src="08_metaanalysis_files/figure-html/stepwise_model-24.png" width="900" /></p>
<pre><code>#&gt; [1] &quot;#NA: 2592&quot;
#&gt; [1] &quot;pearson_col_norm&quot;</code></pre>
<p><img src="08_metaanalysis_files/figure-html/stepwise_model-25.png" width="900" /></p>
<pre><code>#&gt; [1] &quot;#NA: 2592&quot;
#&gt; [1] &quot;pearson_row&quot;</code></pre>
<p><img src="08_metaanalysis_files/figure-html/stepwise_model-26.png" width="900" /></p>
<pre><code>#&gt; [1] &quot;#NA: 0&quot;
#&gt; [1] &quot;pearson_row_norm&quot;</code></pre>
<p><img src="08_metaanalysis_files/figure-html/stepwise_model-27.png" width="900" /></p>
<pre><code>#&gt; [1] &quot;#NA: 0&quot;
#&gt; [1] &quot;pearson_tot&quot;</code></pre>
<p><img src="08_metaanalysis_files/figure-html/stepwise_model-28.png" width="900" /></p>
<pre><code>#&gt; [1] &quot;#NA: 2592&quot;
#&gt; [1] &quot;pearson_tot_norm&quot;</code></pre>
<p><img src="08_metaanalysis_files/figure-html/stepwise_model-29.png" width="900" /></p>
<pre><code>#&gt; [1] &quot;#NA: 2592&quot;
#&gt; [1] &quot;rmse&quot;</code></pre>
<p><img src="08_metaanalysis_files/figure-html/stepwise_model-30.png" width="900" /></p>
<pre><code>#&gt; [1] &quot;#NA: 2592&quot;
#&gt; [1] &quot;rmse_norm&quot;</code></pre>
<p><img src="08_metaanalysis_files/figure-html/stepwise_model-31.png" width="900" /></p>
<pre><code>#&gt; [1] &quot;#NA: 2592&quot;
#&gt; [1] &quot;score_aggreg&quot;</code></pre>
<p><img src="08_metaanalysis_files/figure-html/stepwise_model-32.png" width="900" /></p>
<pre><code>#&gt; [1] &quot;#NA: 0&quot;
#&gt; [1] &quot;sdid&quot;</code></pre>
<p><img src="08_metaanalysis_files/figure-html/stepwise_model-33.png" width="900" /></p>
<pre><code>#&gt; [1] &quot;#NA: 2592&quot;
#&gt; [1] &quot;sdid_norm&quot;</code></pre>
<p><img src="08_metaanalysis_files/figure-html/stepwise_model-34.png" width="900" /></p>
<pre><code>#&gt; [1] &quot;#NA: 2592&quot;
#&gt; [1] &quot;spearman_col&quot;</code></pre>
<p><img src="08_metaanalysis_files/figure-html/stepwise_model-35.png" width="900" /></p>
<pre><code>#&gt; [1] &quot;#NA: 2592&quot;
#&gt; [1] &quot;spearman_col_norm&quot;</code></pre>
<p><img src="08_metaanalysis_files/figure-html/stepwise_model-36.png" width="900" /></p>
<pre><code>#&gt; [1] &quot;#NA: 2592&quot;
#&gt; [1] &quot;spearman_row&quot;</code></pre>
<p><img src="08_metaanalysis_files/figure-html/stepwise_model-37.png" width="900" /></p>
<pre><code>#&gt; [1] &quot;#NA: 0&quot;
#&gt; [1] &quot;spearman_row_norm&quot;</code></pre>
<p><img src="08_metaanalysis_files/figure-html/stepwise_model-38.png" width="900" /></p>
<pre><code>#&gt; [1] &quot;#NA: 0&quot;
#&gt; [1] &quot;spearman_tot&quot;</code></pre>
<p><img src="08_metaanalysis_files/figure-html/stepwise_model-39.png" width="900" /></p>
<pre><code>#&gt; [1] &quot;#NA: 2592&quot;
#&gt; [1] &quot;spearman_tot_norm&quot;</code></pre>
<p><img src="08_metaanalysis_files/figure-html/stepwise_model-40.png" width="900" /></p>
<pre><code>#&gt; [1] &quot;#NA: 2592&quot;

bar = sapply(names(foo)[foo == &quot;char&quot;], function(k) {
  print(paste0(k, &quot;: &quot;, length(unique(results_li[,k]))))
  if (length(unique(results_li[,k]))&gt;1) {
    return(k) 
  } else {
    return(NULL)
  }
})
#&gt; [1] &quot;dataset: 4&quot;
#&gt; [1] &quot;ref: 1&quot;
#&gt; [1] &quot;preprocessing_mixRNA: 3&quot;
#&gt; [1] &quot;feature_selection_mixRNA: 4&quot;
#&gt; [1] &quot;preprocessing_RNA: 3&quot;
#&gt; [1] &quot;feature_selection_RNA: 4&quot;
#&gt; [1] &quot;preprocessing_scRNA: 4&quot;
#&gt; [1] &quot;feature_selection_scRNA: 4&quot;
#&gt; [1] &quot;deconvolution_rna: 3&quot;
#&gt; [1] &quot;preprocessing_mixMET: 3&quot;
#&gt; [1] &quot;feature_selection_mixMET: 2&quot;
#&gt; [1] &quot;preprocessing_MET: 3&quot;
#&gt; [1] &quot;feature_selection_MET: 2&quot;
#&gt; [1] &quot;deconvolution_met: 3&quot;
#&gt; [1] &quot;late_integration: 1&quot;
facts = unlist(bar)
# score = &quot;spearman_tot&quot;
score = &quot;score_aggreg&quot;
f_lo = formula(paste0(score, &quot;~1&quot;))
f_up = formula(paste0(score, &quot;~.&quot;))
m_lo = lm(f_lo, data=results_li[,c(facts, score)])
m_up = lm(f_up, data=results_li[,c(facts, score)])

any_line_na = sum(apply(results_li[,c(facts, score)], 1, \(ligne_i){any(is.na(ligne_i))}))
BIC_constant = log(nrow(results_li) - any_line_na)
life.lm = step(m_lo, method=&quot;forward&quot;, scope=list(upper=m_up,lower=m_lo), k = BIC_constant)
#&gt; Start:  AIC=-50330.9
#&gt; score_aggreg ~ 1
#&gt; 
#&gt;                            Df Sum of Sq    RSS    AIC
#&gt; + dataset                   3    38.942 41.791 -57130
#&gt; + deconvolution_rna         2    18.282 62.451 -52975
#&gt; + feature_selection_mixMET  1     0.856 79.877 -50432
#&gt; + feature_selection_MET     1     0.856 79.877 -50432
#&gt; + feature_selection_mixRNA  3     0.580 80.153 -50378
#&gt; + feature_selection_RNA     3     0.580 80.153 -50378
#&gt; + preprocessing_mixRNA      2     0.358 80.374 -50358
#&gt; + preprocessing_RNA         2     0.358 80.374 -50358
#&gt; + deconvolution_met         2     0.197 80.536 -50338
#&gt; &lt;none&gt;                                  80.732 -50331
#&gt; + preprocessing_scRNA       3     0.159 80.573 -50324
#&gt; + feature_selection_scRNA   3     0.159 80.573 -50324
#&gt; + preprocessing_mixMET      2     0.005 80.727 -50313
#&gt; + preprocessing_MET         2     0.005 80.727 -50313
#&gt; 
#&gt; Step:  AIC=-57130.17
#&gt; score_aggreg ~ dataset
#&gt; 
#&gt;                            Df Sum of Sq    RSS    AIC
#&gt; + deconvolution_rna         2    18.282 23.509 -63076
#&gt; + feature_selection_mixMET  1     0.856 40.935 -57335
#&gt; + feature_selection_MET     1     0.856 40.935 -57335
#&gt; + feature_selection_mixRNA  3     0.580 41.211 -57247
#&gt; + feature_selection_RNA     3     0.580 41.211 -57247
#&gt; + preprocessing_mixRNA      2     0.358 41.433 -57201
#&gt; + preprocessing_RNA         2     0.358 41.433 -57201
#&gt; + deconvolution_met         2     0.197 41.594 -57161
#&gt; + preprocessing_scRNA       3     0.159 41.631 -57142
#&gt; + feature_selection_scRNA   3     0.159 41.631 -57142
#&gt; &lt;none&gt;                                  41.791 -57130
#&gt; + preprocessing_mixMET      2     0.005 41.785 -57113
#&gt; + preprocessing_MET         2     0.005 41.785 -57113
#&gt; - dataset                   3    38.942 80.732 -50331
#&gt; 
#&gt; Step:  AIC=-63076.42
#&gt; score_aggreg ~ dataset + deconvolution_rna
#&gt; 
#&gt;                            Df Sum of Sq    RSS    AIC
#&gt; + feature_selection_mixMET  1     0.856 22.653 -63452
#&gt; + feature_selection_MET     1     0.856 22.653 -63452
#&gt; + feature_selection_mixRNA  3     0.580 22.929 -63308
#&gt; + feature_selection_RNA     3     0.580 22.929 -63308
#&gt; + preprocessing_mixRNA      2     0.358 23.151 -63217
#&gt; + preprocessing_RNA         2     0.358 23.151 -63217
#&gt; + deconvolution_met         2     0.197 23.312 -63145
#&gt; + preprocessing_scRNA       3     0.159 23.349 -63119
#&gt; + feature_selection_scRNA   3     0.159 23.349 -63119
#&gt; &lt;none&gt;                                  23.509 -63076
#&gt; + preprocessing_mixMET      2     0.005 23.504 -63060
#&gt; + preprocessing_MET         2     0.005 23.504 -63060
#&gt; - deconvolution_rna         2    18.282 41.791 -57130
#&gt; - dataset                   3    38.942 62.451 -52975
#&gt; 
#&gt; Step:  AIC=-63451.7
#&gt; score_aggreg ~ dataset + deconvolution_rna + feature_selection_mixMET
#&gt; 
#&gt;                            Df Sum of Sq    RSS    AIC
#&gt; + feature_selection_mixRNA  3     0.580 22.073 -63693
#&gt; + feature_selection_RNA     3     0.580 22.073 -63693
#&gt; + preprocessing_mixRNA      2     0.358 22.295 -63598
#&gt; + preprocessing_RNA         2     0.358 22.295 -63598
#&gt; + deconvolution_met         2     0.197 22.456 -63524
#&gt; + preprocessing_scRNA       3     0.159 22.493 -63497
#&gt; + feature_selection_scRNA   3     0.159 22.493 -63497
#&gt; &lt;none&gt;                                  22.653 -63452
#&gt; + preprocessing_mixMET      2     0.005 22.648 -63436
#&gt; + preprocessing_MET         2     0.005 22.648 -63436
#&gt; - feature_selection_mixMET  1     0.856 23.509 -63076
#&gt; - deconvolution_rna         2    18.282 40.935 -57335
#&gt; - dataset                   3    38.942 61.595 -53108
#&gt; 
#&gt; Step:  AIC=-63692.82
#&gt; score_aggreg ~ dataset + deconvolution_rna + feature_selection_mixMET + 
#&gt;     feature_selection_mixRNA
#&gt; 
#&gt;                            Df Sum of Sq    RSS    AIC
#&gt; + preprocessing_mixRNA      2     0.358 21.715 -63844
#&gt; + preprocessing_RNA         2     0.358 21.715 -63844
#&gt; + deconvolution_met         2     0.197 21.876 -63767
#&gt; &lt;none&gt;                                  22.073 -63693
#&gt; + preprocessing_mixMET      2     0.005 22.068 -63677
#&gt; + preprocessing_MET         2     0.005 22.068 -63677
#&gt; + preprocessing_scRNA       2     0.000 22.073 -63674
#&gt; + feature_selection_scRNA   2     0.000 22.073 -63674
#&gt; - feature_selection_mixRNA  3     0.580 22.653 -63452
#&gt; - feature_selection_mixMET  1     0.856 22.929 -63308
#&gt; - deconvolution_rna         2    18.282 40.355 -57456
#&gt; - dataset                   3    38.942 61.015 -53179
#&gt; 
#&gt; Step:  AIC=-63843.9
#&gt; score_aggreg ~ dataset + deconvolution_rna + feature_selection_mixMET + 
#&gt;     feature_selection_mixRNA + preprocessing_mixRNA
#&gt; 
#&gt;                            Df Sum of Sq    RSS    AIC
#&gt; + deconvolution_met         2     0.197 21.518 -63920
#&gt; &lt;none&gt;                                  21.715 -63844
#&gt; + preprocessing_mixMET      2     0.005 21.710 -63828
#&gt; + preprocessing_MET         2     0.005 21.710 -63828
#&gt; + preprocessing_scRNA       2     0.000 21.715 -63825
#&gt; + feature_selection_scRNA   2     0.000 21.715 -63825
#&gt; - preprocessing_mixRNA      2     0.358 22.073 -63693
#&gt; - feature_selection_mixRNA  3     0.580 22.295 -63598
#&gt; - feature_selection_mixMET  1     0.856 22.571 -63452
#&gt; - deconvolution_rna         2    18.282 39.997 -57530
#&gt; - dataset                   3    38.942 60.657 -53221
#&gt; 
#&gt; Step:  AIC=-63919.85
#&gt; score_aggreg ~ dataset + deconvolution_rna + feature_selection_mixMET + 
#&gt;     feature_selection_mixRNA + preprocessing_mixRNA + deconvolution_met
#&gt; 
#&gt;                            Df Sum of Sq    RSS    AIC
#&gt; &lt;none&gt;                                  21.518 -63920
#&gt; + preprocessing_mixMET      2     0.005 21.513 -63904
#&gt; + preprocessing_MET         2     0.005 21.513 -63904
#&gt; + preprocessing_scRNA       2     0.000 21.518 -63901
#&gt; + feature_selection_scRNA   2     0.000 21.518 -63901
#&gt; - deconvolution_met         2     0.197 21.715 -63844
#&gt; - preprocessing_mixRNA      2     0.358 21.876 -63767
#&gt; - feature_selection_mixRNA  3     0.580 22.098 -63672
#&gt; - feature_selection_mixMET  1     0.856 22.374 -63525
#&gt; - deconvolution_rna         2    18.282 39.800 -57562
#&gt; - dataset                   3    38.942 60.460 -53236
# Step:  AIC=-746072.7
# score_aggreg ~ deconvolution_rna + dataset + deconvolution_met + 
#     feature_selection_mixRNA + late_integration + preprocessing_mixRNA + 
#     preprocessing_mixMET + preprocessing_scRNA

life.lm = step(m_lo, method=&quot;both&quot;, scope=list(upper=m_up,lower=m_lo), k = BIC_constant)
#&gt; Start:  AIC=-50330.9
#&gt; score_aggreg ~ 1
#&gt; 
#&gt;                            Df Sum of Sq    RSS    AIC
#&gt; + dataset                   3    38.942 41.791 -57130
#&gt; + deconvolution_rna         2    18.282 62.451 -52975
#&gt; + feature_selection_mixMET  1     0.856 79.877 -50432
#&gt; + feature_selection_MET     1     0.856 79.877 -50432
#&gt; + feature_selection_mixRNA  3     0.580 80.153 -50378
#&gt; + feature_selection_RNA     3     0.580 80.153 -50378
#&gt; + preprocessing_mixRNA      2     0.358 80.374 -50358
#&gt; + preprocessing_RNA         2     0.358 80.374 -50358
#&gt; + deconvolution_met         2     0.197 80.536 -50338
#&gt; &lt;none&gt;                                  80.732 -50331
#&gt; + preprocessing_scRNA       3     0.159 80.573 -50324
#&gt; + feature_selection_scRNA   3     0.159 80.573 -50324
#&gt; + preprocessing_mixMET      2     0.005 80.727 -50313
#&gt; + preprocessing_MET         2     0.005 80.727 -50313
#&gt; 
#&gt; Step:  AIC=-57130.17
#&gt; score_aggreg ~ dataset
#&gt; 
#&gt;                            Df Sum of Sq    RSS    AIC
#&gt; + deconvolution_rna         2    18.282 23.509 -63076
#&gt; + feature_selection_mixMET  1     0.856 40.935 -57335
#&gt; + feature_selection_MET     1     0.856 40.935 -57335
#&gt; + feature_selection_mixRNA  3     0.580 41.211 -57247
#&gt; + feature_selection_RNA     3     0.580 41.211 -57247
#&gt; + preprocessing_mixRNA      2     0.358 41.433 -57201
#&gt; + preprocessing_RNA         2     0.358 41.433 -57201
#&gt; + deconvolution_met         2     0.197 41.594 -57161
#&gt; + preprocessing_scRNA       3     0.159 41.631 -57142
#&gt; + feature_selection_scRNA   3     0.159 41.631 -57142
#&gt; &lt;none&gt;                                  41.791 -57130
#&gt; + preprocessing_mixMET      2     0.005 41.785 -57113
#&gt; + preprocessing_MET         2     0.005 41.785 -57113
#&gt; - dataset                   3    38.942 80.732 -50331
#&gt; 
#&gt; Step:  AIC=-63076.42
#&gt; score_aggreg ~ dataset + deconvolution_rna
#&gt; 
#&gt;                            Df Sum of Sq    RSS    AIC
#&gt; + feature_selection_mixMET  1     0.856 22.653 -63452
#&gt; + feature_selection_MET     1     0.856 22.653 -63452
#&gt; + feature_selection_mixRNA  3     0.580 22.929 -63308
#&gt; + feature_selection_RNA     3     0.580 22.929 -63308
#&gt; + preprocessing_mixRNA      2     0.358 23.151 -63217
#&gt; + preprocessing_RNA         2     0.358 23.151 -63217
#&gt; + deconvolution_met         2     0.197 23.312 -63145
#&gt; + preprocessing_scRNA       3     0.159 23.349 -63119
#&gt; + feature_selection_scRNA   3     0.159 23.349 -63119
#&gt; &lt;none&gt;                                  23.509 -63076
#&gt; + preprocessing_mixMET      2     0.005 23.504 -63060
#&gt; + preprocessing_MET         2     0.005 23.504 -63060
#&gt; - deconvolution_rna         2    18.282 41.791 -57130
#&gt; - dataset                   3    38.942 62.451 -52975
#&gt; 
#&gt; Step:  AIC=-63451.7
#&gt; score_aggreg ~ dataset + deconvolution_rna + feature_selection_mixMET
#&gt; 
#&gt;                            Df Sum of Sq    RSS    AIC
#&gt; + feature_selection_mixRNA  3     0.580 22.073 -63693
#&gt; + feature_selection_RNA     3     0.580 22.073 -63693
#&gt; + preprocessing_mixRNA      2     0.358 22.295 -63598
#&gt; + preprocessing_RNA         2     0.358 22.295 -63598
#&gt; + deconvolution_met         2     0.197 22.456 -63524
#&gt; + preprocessing_scRNA       3     0.159 22.493 -63497
#&gt; + feature_selection_scRNA   3     0.159 22.493 -63497
#&gt; &lt;none&gt;                                  22.653 -63452
#&gt; + preprocessing_mixMET      2     0.005 22.648 -63436
#&gt; + preprocessing_MET         2     0.005 22.648 -63436
#&gt; - feature_selection_mixMET  1     0.856 23.509 -63076
#&gt; - deconvolution_rna         2    18.282 40.935 -57335
#&gt; - dataset                   3    38.942 61.595 -53108
#&gt; 
#&gt; Step:  AIC=-63692.82
#&gt; score_aggreg ~ dataset + deconvolution_rna + feature_selection_mixMET + 
#&gt;     feature_selection_mixRNA
#&gt; 
#&gt;                            Df Sum of Sq    RSS    AIC
#&gt; + preprocessing_mixRNA      2     0.358 21.715 -63844
#&gt; + preprocessing_RNA         2     0.358 21.715 -63844
#&gt; + deconvolution_met         2     0.197 21.876 -63767
#&gt; &lt;none&gt;                                  22.073 -63693
#&gt; + preprocessing_mixMET      2     0.005 22.068 -63677
#&gt; + preprocessing_MET         2     0.005 22.068 -63677
#&gt; + preprocessing_scRNA       2     0.000 22.073 -63674
#&gt; + feature_selection_scRNA   2     0.000 22.073 -63674
#&gt; - feature_selection_mixRNA  3     0.580 22.653 -63452
#&gt; - feature_selection_mixMET  1     0.856 22.929 -63308
#&gt; - deconvolution_rna         2    18.282 40.355 -57456
#&gt; - dataset                   3    38.942 61.015 -53179
#&gt; 
#&gt; Step:  AIC=-63843.9
#&gt; score_aggreg ~ dataset + deconvolution_rna + feature_selection_mixMET + 
#&gt;     feature_selection_mixRNA + preprocessing_mixRNA
#&gt; 
#&gt;                            Df Sum of Sq    RSS    AIC
#&gt; + deconvolution_met         2     0.197 21.518 -63920
#&gt; &lt;none&gt;                                  21.715 -63844
#&gt; + preprocessing_mixMET      2     0.005 21.710 -63828
#&gt; + preprocessing_MET         2     0.005 21.710 -63828
#&gt; + preprocessing_scRNA       2     0.000 21.715 -63825
#&gt; + feature_selection_scRNA   2     0.000 21.715 -63825
#&gt; - preprocessing_mixRNA      2     0.358 22.073 -63693
#&gt; - feature_selection_mixRNA  3     0.580 22.295 -63598
#&gt; - feature_selection_mixMET  1     0.856 22.571 -63452
#&gt; - deconvolution_rna         2    18.282 39.997 -57530
#&gt; - dataset                   3    38.942 60.657 -53221
#&gt; 
#&gt; Step:  AIC=-63919.85
#&gt; score_aggreg ~ dataset + deconvolution_rna + feature_selection_mixMET + 
#&gt;     feature_selection_mixRNA + preprocessing_mixRNA + deconvolution_met
#&gt; 
#&gt;                            Df Sum of Sq    RSS    AIC
#&gt; &lt;none&gt;                                  21.518 -63920
#&gt; + preprocessing_mixMET      2     0.005 21.513 -63904
#&gt; + preprocessing_MET         2     0.005 21.513 -63904
#&gt; + preprocessing_scRNA       2     0.000 21.518 -63901
#&gt; + feature_selection_scRNA   2     0.000 21.518 -63901
#&gt; - deconvolution_met         2     0.197 21.715 -63844
#&gt; - preprocessing_mixRNA      2     0.358 21.876 -63767
#&gt; - feature_selection_mixRNA  3     0.580 22.098 -63672
#&gt; - feature_selection_mixMET  1     0.856 22.374 -63525
#&gt; - deconvolution_rna         2    18.282 39.800 -57562
#&gt; - dataset                   3    38.942 60.460 -53236
# Step:  AIC=-746072.7
# score_aggreg ~ deconvolution_rna + dataset + deconvolution_met + 
#     feature_selection_mixRNA + late_integration + preprocessing_mixRNA + 
#     preprocessing_mixMET + preprocessing_scRNA


# spearman_tot ~ late_integration + deconvolution_rna + feature_selection_mixRNA + 
#     dataset + deconvolution_met + preprocessing_mixMET + preprocessing_mixRNA + 
#     feature_selection_mixMET


# boxplot(formula(paste0(score, &quot;~late_integration&quot;)), results_li[,c(facts, score)])

# boxplot(formula(paste0(score, &quot;~late_integration + deconvolution_rna&quot;)), results_li[,c(facts, score)], las=2)


boxplot(formula(paste0(score, &quot;~dataset&quot;)), results_li[,c(facts, score)])</code></pre>
<p><img src="08_metaanalysis_files/figure-html/stepwise_model-41.png" width="900" /></p>
<pre class="r"><code>
boxplot(formula(paste0(score, &quot;~deconvolution_rna&quot;)), results_li[,c(facts, score)], las=2, na.rm = TRUE)</code></pre>
<p><img src="08_metaanalysis_files/figure-html/stepwise_model-42.png" width="900" /></p>
<pre class="r"><code>
boxplot(formula(paste0(score, &quot;~deconvolution_met&quot;)), results_li[,c(facts, score)], las=2, na.rm = TRUE)</code></pre>
<p><img src="08_metaanalysis_files/figure-html/stepwise_model-43.png" width="900" /></p>
</div>
<div id="pca" class="section level1" number="4">
<h1><span class="header-section-number">4</span> PCA</h1>
<pre class="r"><code># row_rm = apply(results_li,1,function(x) any(is.na(x)))
# results_li_rm = results_li[!row_rm,]
# # code above can be resumed by suppressing invitro and invivo dataset because we can&#39;t apply jsd metrics for the first and all non correlation metrics for the second

# Then for the PCA, we remove jsd (which is highly correlated to other metrics) and the in vivo dataset
# results_li_rm = results_li[results_li$dataset != &quot;invivo1&quot;, -c(which(colnames(results_li) %in% c(&quot;jsd&quot;, &quot;jsd_norm&quot;)))]

results_li_rm &lt;- results_li[
  !results_li$dataset %in% c(&quot;invivo1&quot;, &quot;invivo2&quot;),
  -which(colnames(results_li) %in% c(&quot;jsd&quot;, &quot;jsd_norm&quot;))
]


score_aggreg_order = grep(&quot;score_aggreg&quot;, colnames(results_li_rm))
normalised_metrics = grep(&quot;norm&quot;, colnames(results_li_rm))
unnormalised_metrics = (1:ncol(results_li_rm))[-c(1:(length(all_functions_li)+2), score_aggreg_order, normalised_metrics)]
corr_metric = c(grep(&quot;pearson&quot;, colnames(results_li_rm)), grep(&quot;spearman&quot;, colnames(results_li_rm)))
stepwise_most_var = which(colnames(results_li_rm) %in% c(&quot;dataset&quot;, &quot;late_integration&quot;, &quot;deconvolution_rna&quot;, &quot;deconvolution_met&quot;))

pca_results_li_rm = PCA(results_li_rm[,c(score_aggreg_order, stepwise_most_var, unnormalised_metrics)], quanti.sup = 1, quali.sup = 2:(length(stepwise_most_var)+1), graph = FALSE)

barplot(pca_results_li_rm$eig[,2])</code></pre>
<p><img src="08_metaanalysis_files/figure-html/val_propre_pca-1.png" width="900" /></p>
<p>Les trois premières composantes seront analysées, représentant 96% de
la variabilité totale des différentes métriques.</p>
<pre class="r"><code># par(mfrow = c(3,2))
# plot(pca_results_li_rm, axes = c(1, 2), choix=&quot;ind&quot;)
plot(pca_results_li_rm, axes = c(1, 2), choix=&quot;var&quot;)</code></pre>
<p><img src="08_metaanalysis_files/figure-html/var_plot_pca-1.png" width="900" /></p>
<pre class="r"><code># plot(pca_results_li_rm, axes = c(1, 3), choix=&quot;ind&quot;)
plot(pca_results_li_rm, axes = c(1, 3), choix=&quot;var&quot;)</code></pre>
<p><img src="08_metaanalysis_files/figure-html/var_plot_pca-2.png" width="900" /></p>
<pre class="r"><code># plot(pca_results_li_rm, axes = c(2, 3), choix=&quot;ind&quot;)
plot(pca_results_li_rm, axes = c(2, 3), choix=&quot;var&quot;)</code></pre>
<p><img src="08_metaanalysis_files/figure-html/var_plot_pca-3.png" width="900" /></p>
<pre class="r"><code># par(mfrow = c(1,1))</code></pre>
<pre class="r"><code>dimdesc(pca_results_li_rm)</code></pre>
<ul>
<li>Premier axe construit par l’ensemble des variables, les metriques de
corrélation sont corrélé positivement au score aggreg et celle style
RMSE négativement de part leur construction (un groupe indique une bonne
estimation par 1 et l’autre par 0)</li>
<li>second axe construit par les corrélations en lignes (types cell) et
un peu par aitchison, les deux sont anticorrélé sur cet axe</li>
<li>troisième axe construit majoritairement par aitchison et un peu par
les corrélations en lignes (types cell). Le score aggreg est
complétement indépendant de cette dimension</li>
</ul>
<pre class="r"><code># # faire d&#39;abords le svar qui explique le plus score aggreg pour ensuite voir leurs ellipses dans la PCA
# plotellipses(pca_results_li_stand_rm, axes = c(1, 2), pch = &#39;.&#39;)
# # vraiment moche, il ne faudrait ps afficher tout les points

plot_density_groups &lt;- function(res_pca, axes = c(1,2), alpha = 0.7) {
  
  # Extraction des coordonnées individuelles
  if(&quot;PCA&quot; %in% class(res_pca)) {
    coord_ind &lt;- res_pca$ind$coord[, axes]
    quali_sup &lt;- res_pca$call$quali.sup
  } else if(&quot;CA&quot; %in% class(res_pca)) {
    coord_ind &lt;- res_pca$row$coord[, axes]
    quali_sup &lt;- res_pca$call$quali.sup  
  } else if(&quot;MCA&quot; %in% class(res_pca)) {
    coord_ind &lt;- res_pca$ind$coord[, axes]
    quali_sup &lt;- res_pca$call$quali.sup
  }
  
  # Récupération des données originales
  data_orig &lt;- res_pca$call$X
  
  library(ggplot2)
  library(ggrepel)
  
  # Liste pour stocker les graphiques
  plots_list &lt;- list()
  
  # Boucle sur chaque variable qualitative supplémentaire
  for(i in 1:length(quali_sup$numero)) {
    var_name &lt;- colnames(quali_sup$quali.sup)[i]
    quali_var &lt;- data_orig[, quali_sup$numero[i]]
    
    # Dataframe pour le graphique
    df &lt;- data.frame(
      Dim1 = coord_ind[, 1],
      Dim2 = coord_ind[, 2],
      groupe = quali_var
    )
    
    # Calcul des barycentres
    barycentres &lt;- aggregate(cbind(Dim1, Dim2) ~ groupe, df, mean)
    
    # Création du graphique
    p &lt;- ggplot(df, aes(x = Dim1, y = Dim2, color = groupe)) +
      geom_density_2d(alpha = alpha) +
      geom_point(data = barycentres, size = 3) +
      geom_text_repel(data = barycentres, aes(label = groupe)) +
      labs(
        title = var_name, color = var_name, 
        x = paste0(&quot;Dim&quot;, axes[1]), y = paste0(&quot;Dim&quot;, axes[2])
      ) +
      theme(legend.position = &quot;bottom&quot;)
    
    plots_list[[var_name]] &lt;- p
  }
  
  # Affichage du panel
  if(length(plots_list) &gt; 1) {
    gridExtra::grid.arrange(grobs = plots_list, ncol = 2)
  } else {
    print(plots_list[[1]])
  }
}

plot_density_groups(res_pca = pca_results_li_rm, axes = c(1,2))</code></pre>
<p><img src="08_metaanalysis_files/figure-html/new_plot_ellipses-1.png" width="900" /></p>
<pre class="r"><code>plot_density_groups(res_pca = pca_results_li_rm, axes = c(1,3))</code></pre>
<p><img src="08_metaanalysis_files/figure-html/new_plot_ellipses-2.png" width="900" /></p>
<pre class="r"><code>plot_density_groups(res_pca = pca_results_li_rm, axes = c(2,3))</code></pre>
<p><img src="08_metaanalysis_files/figure-html/new_plot_ellipses-3.png" width="900" /></p>
</div>
<div id="standardise-data-by-dataset" class="section level1" number="5">
<h1><span class="header-section-number">5</span> Standardise data by
dataset</h1>
<pre class="r"><code>results_li_stand &lt;- results_li %&gt;%
  group_by(dataset) %&gt;%
  mutate(across(where(is.numeric), ~ .x - mean(.x, na.rm = TRUE))) %&gt;%
  ungroup() %&gt;% 
  as.data.frame()

# attributes(results_li[,k])

# # verification
# results_li_stand %&gt;%
#   group_by(dataset) %&gt;%
#   summarise(mean(aitchison))
# plot(density(results_li$aitchison, na.rm=TRUE))
# plot(density(results_li$aitchison[results_li$dataset == &#39;invitro1&#39;], na.rm=TRUE))
# plot(density(results_li_stand$aitchison, na.rm=TRUE))
# 
# results_li_stand %&gt;%
#   group_by(dataset) %&gt;%
#   summarise(mean(spearman_row))
# plot(density(results_li$spearman_row, na.rm=TRUE))
# plot(density(results_li$spearman_row[results_li$dataset == &#39;invitro1&#39;], na.rm=TRUE))
# plot(density(results_li_stand$spearman_row, na.rm=TRUE))</code></pre>
<div id="correlations-of-the-different-metrics-1" class="section level2"
number="5.1">
<h2><span class="header-section-number">5.1</span> Correlations of the
different metrics</h2>
<pre class="r"><code>
# Fonction personnalisée pour corrélations avec couleurs et légende
cor_fun_colored &lt;- function(data, mapping, method = &quot;pearson&quot;, ndp = 2, sz = 4, ...) {
  x &lt;- eval_data_col(data, mapping$x)
  y &lt;- eval_data_col(data, mapping$y)
  corr &lt;- cor(x, y, method = method, use = &quot;complete.obs&quot;)
  
  # Palette de couleurs continue de -1 à 1
  # Utilisation d&#39;une palette divergente : bleu (négatif) - blanc (0) - rouge (positif)
  color_palette &lt;- colorRampPalette(c(&quot;#2166AC&quot;, &quot;#F7F7F7&quot;, &quot;#B2182B&quot;))(100)
  color_index &lt;- round((corr + 1) * 50) + 1  # Convertit [-1,1] en [1,100]
  color_index &lt;- pmax(1, pmin(100, color_index))  # Assure que l&#39;index est dans [1,100]
  col_cor &lt;- color_palette[color_index]
  
  ggally_text(label = paste0(&quot;Corr &quot;, method, &quot; :\n&quot;, round(corr, ndp)), 
              color = col_cor, 
              size = sz,
              fontface = &quot;bold&quot;) +
    theme_void()
}

density_fun &lt;- function(data, mapping, ...) {
  ggplot(data = data, mapping = mapping) +
    geom_density2d(alpha = 0.6, color = &quot;steelblue&quot;, ...)# +
    # xlim(0, 1) +
    # ylim(0, 1)
}

# Version finale optimisée
ggpairs_final_standardise &lt;- ggpairs(
  results_li_stand,  # Dataset complet
  columns = c(&quot;score_aggreg&quot;, &quot;rmse_norm&quot;, &quot;pearson_col_norm&quot;, &quot;spearman_col_norm&quot;, &quot;aid_norm&quot;, &quot;jsd_norm&quot;),
  upper = list(continuous = cor_fun_colored),
  lower = list(continuous = density_fun),
  # lower = list(continuous = wrap(&quot;density&quot;, alpha = 0.6, bins = 10, fill = &quot;steelblue&quot;, xlim = c(0,1), ylim = c(0,1))),
  diag = list(continuous = wrap(&quot;densityDiag&quot;, alpha = 0.8, fill = &quot;lightblue&quot;))
) + 
theme(
  strip.text = element_text(size = 10, face = &quot;bold&quot;),
  axis.text = element_text(size = 8)
)

print(ggpairs_final_standardise)
#&gt; Warning: Removed 2592 rows containing non-finite outside the scale range
#&gt; (`stat_density2d()`).
#&gt; Warning: Removed 2592 rows containing non-finite outside the scale range
#&gt; (`stat_density()`).
#&gt; Warning: Removed 2592 rows containing non-finite outside the scale range
#&gt; (`stat_density2d()`).
#&gt; Removed 2592 rows containing non-finite outside the scale range
#&gt; (`stat_density2d()`).
#&gt; Warning: Removed 2592 rows containing non-finite outside the scale range
#&gt; (`stat_density()`).
#&gt; Warning: Removed 2592 rows containing non-finite outside the scale range
#&gt; (`stat_density2d()`).
#&gt; Removed 2592 rows containing non-finite outside the scale range
#&gt; (`stat_density2d()`).
#&gt; Removed 2592 rows containing non-finite outside the scale range
#&gt; (`stat_density2d()`).
#&gt; Warning: Removed 2592 rows containing non-finite outside the scale range
#&gt; (`stat_density()`).
#&gt; Warning: Removed 2592 rows containing non-finite outside the scale range
#&gt; (`stat_density2d()`).
#&gt; Removed 2592 rows containing non-finite outside the scale range
#&gt; (`stat_density2d()`).
#&gt; Removed 2592 rows containing non-finite outside the scale range
#&gt; (`stat_density2d()`).
#&gt; Removed 2592 rows containing non-finite outside the scale range
#&gt; (`stat_density2d()`).
#&gt; Warning: Removed 2592 rows containing non-finite outside the scale range
#&gt; (`stat_density()`).
#&gt; Warning: Removed 7776 rows containing non-finite outside the scale range
#&gt; (`stat_density2d()`).
#&gt; Removed 7776 rows containing non-finite outside the scale range
#&gt; (`stat_density2d()`).
#&gt; Removed 7776 rows containing non-finite outside the scale range
#&gt; (`stat_density2d()`).
#&gt; Removed 7776 rows containing non-finite outside the scale range
#&gt; (`stat_density2d()`).
#&gt; Removed 7776 rows containing non-finite outside the scale range
#&gt; (`stat_density2d()`).
#&gt; Warning: Removed 7776 rows containing non-finite outside the scale range
#&gt; (`stat_density()`).</code></pre>
<p><img src="08_metaanalysis_files/figure-html/cor_dens_plot_standardise-1.png" width="900" /></p>
<ul>
<li>Corrélations proche de celles observées avant standardisation par
datasets</li>
</ul>
<pre class="r"><code># results_li_stand[results_li_stand==&quot;NaN&quot;] = NA
row_rm = apply(results_li_stand,1,function(x) any(is.na(x)))
results_li_stand_rm = results_li_stand[!row_rm,-(1:(length(all_functions_li)+2))]

score_aggreg_order = grep(&quot;score_aggreg&quot;, colnames(results_li_stand_rm))
normalised_metrics = grep(&quot;norm&quot;, colnames(results_li_stand_rm))
unnormalised_metrics = (1:ncol(results_li_stand_rm))[-c(score_aggreg_order, normalised_metrics)]
corr_metric = c(grep(&quot;pearson&quot;, colnames(results_li_stand_rm)), grep(&quot;spearman&quot;, colnames(results_li_stand_rm)))

correlations_standardise = cor(results_li_stand_rm[,c(
  score_aggreg_order, 
  normalised_metrics[!(normalised_metrics %in% corr_metric)], 
  normalised_metrics[normalised_metrics %in% corr_metric], 
  unnormalised_metrics[!(unnormalised_metrics %in% corr_metric)],
  unnormalised_metrics[unnormalised_metrics %in% corr_metric]
)])
corrplot::corrplot(correlations_standardise, method=&#39;ellipse&#39;, type=&#39;full&#39;, outline=T, tl.col=&#39;black&#39;)</code></pre>
<p><img src="08_metaanalysis_files/figure-html/cor_plot_standardise-1.png" width="900" /></p>
<ul>
<li>Aitchison et pearson row (type cell) restent les plus
différentiables.</li>
<li>Comme pour le graphique précédent, il y a une augmentation générale
légère de la corrélation</li>
</ul>
</div>
<div id="florent-stepwise-model-1" class="section level2" number="5.2">
<h2><span class="header-section-number">5.2</span> Florent stepwise
model</h2>
<pre class="r"><code>foo = sapply(names(results_li_stand), function(k) {
  print(k)
  main = k
  if (is.character(results_li_stand[,k]) || is.factor(results_li_stand[,k])) {
    barplot(table(results_li_stand[,k], useNA=&quot;always&quot;), las=2, main=main)
    return(&quot;char&quot;)
k  } else if (is.numeric(results_li_stand[,k])){
      plot(density(results_li_stand[,k], na.rm=TRUE), main=main)
      print(paste0(&quot;#NA: &quot;, sum(is.na(results_li_stand[,k]))))
    return(&quot;num&quot;)
  } else {
    stop(paste0(&quot;Data type not treated: &quot;, k))
  }
})

bar = sapply(names(foo)[foo == &quot;char&quot;], function(k) {
  print(paste0(k, &quot;: &quot;, length(unique(results_li_stand[,k]))))
  if (length(unique(results_li_stand[,k]))&gt;1) {
    return(k) 
  } else {
    return(NULL)
  }
})
facts = unlist(bar)
# score = &quot;spearman_tot&quot;
score = &quot;score_aggreg&quot;
f_lo = formula(paste0(score, &quot;~1&quot;))
f_up = formula(paste0(score, &quot;~.&quot;))
m_lo = lm(f_lo, data=results_li_stand[,c(facts, score)])
m_up = lm(f_up, data=results_li_stand[,c(facts, score)])

any_line_na = sum(apply(results_li_stand[,c(facts, score)], 1, \(ligne_i){any(is.na(ligne_i))}))
BIC_constant = log(nrow(results_li_stand) - any_line_na)
life.lm = step(m_lo, method=&quot;forward&quot;, scope=list(upper=m_up,lower=m_lo), k = BIC_constant)
# Step:  AIC=-746072.7
# score_aggreg ~ deconvolution_rna + dataset + deconvolution_met + 
#     feature_selection_mixRNA + late_integration + preprocessing_mixRNA + 
#     preprocessing_mixMET + preprocessing_scRNA

life.lm = step(m_lo, method=&quot;both&quot;, scope=list(upper=m_up,lower=m_lo), k = BIC_constant)
# Step:  AIC=-746120.2
# score_aggreg ~ deconvolution_rna + deconvolution_met + feature_selection_mixRNA + 
#     late_integration + preprocessing_mixRNA + preprocessing_mixMET + 
#     preprocessing_scRNA



# boxplot(formula(paste0(score, &quot;~late_integration&quot;)), results_li_stand[,c(facts, score)])

# boxplot(formula(paste0(score, &quot;~late_integration + deconvolution_rna&quot;)), results_li_stand[,c(facts, score)], las=2)


boxplot(formula(paste0(score, &quot;~dataset&quot;)), results_li_stand[,c(facts, score)])

boxplot(formula(paste0(score, &quot;~deconvolution_rna&quot;)), results_li_stand[,c(facts, score)], las=2, na.rm = TRUE)

boxplot(formula(paste0(score, &quot;~deconvolution_met&quot;)), results_li_stand[,c(facts, score)], las=2, na.rm = TRUE)

boxplot(formula(paste0(score, &quot;~late_integration&quot;)), results_li_stand[,c(facts, score)], las=2, na.rm = TRUE)
</code></pre>
<p>Grâce à la standardisation par dataset, on a un BIC plus faible (donc
meilleur) avec exactement les mêmes variables sélectionnées dans le même
ordre (ce qui n’est pas si étonnant a posteriori).</p>
<p>Pour RNA, c’est RLR et RLRpoisson qui sont les meilleurs méthodes de
deconvo (suivie par node donc onlyMET). De même pour la deconvo MET, RLR
et RLRpoisson sont les meilleurs méthodes.</p>
<!--liCTSens fait bien exactement la même chose que limean et -->
<p>OnlyMET est bien la méthode d’integration tardive la plus performante
en medianne et la plus constante.</p>
</div>
<div id="pca-1" class="section level2" number="5.3">
<h2><span class="header-section-number">5.3</span> PCA</h2>
<pre class="r"><code># row_rm = apply(results_li_stand,1,function(x) any(is.na(x)))
# results_li_stand_rm = results_li_stand[!row_rm,]
# # code above can be resumed by suppressing invitro and invivo dataset because we can&#39;t apply jsd metrics for the first and all non correlation metrics for the second

# Then for the PCA, we remove jsd (which is highly correlated to other metrics) and the in vivo dataset
results_li_stand_rm = results_li_stand[results_li_stand$dataset != &quot;invivo1&quot;, -c(which(colnames(results_li_stand) %in% c(&quot;jsd&quot;, &quot;jsd_norm&quot;)))]


score_aggreg_order = grep(&quot;score_aggreg&quot;, colnames(results_li_stand_rm))
normalised_metrics = grep(&quot;norm&quot;, colnames(results_li_stand_rm))
unnormalised_metrics = (1:ncol(results_li_stand_rm))[-c(1:(length(all_functions_li)+2), score_aggreg_order, normalised_metrics)]
corr_metric = c(grep(&quot;pearson&quot;, colnames(results_li_stand_rm)), grep(&quot;spearman&quot;, colnames(results_li_stand_rm)))
stepwise_most_var = which(colnames(results_li_stand_rm) %in% c(&quot;late_integration&quot;, &quot;deconvolution_rna&quot;, &quot;deconvolution_met&quot;))

pca_results_li_stand_rm = PCA(results_li_stand_rm[,c(score_aggreg_order, stepwise_most_var, unnormalised_metrics)], quanti.sup = 1, quali.sup = 2:(length(stepwise_most_var)+1), graph = FALSE)
#&gt; Warning in PCA(results_li_stand_rm[, c(score_aggreg_order, stepwise_most_var, :
#&gt; Missing values are imputed by the mean of the variable: you should use the
#&gt; imputePCA function of the missMDA package
barplot(pca_results_li_stand_rm$eig[,2])</code></pre>
<p><img src="08_metaanalysis_files/figure-html/val_propre_pca_standardise-1.png" width="900" /></p>
<p>Les trois premières composantes seront analysées, représentant
toujours 96% de la variabilité totale des différentes métriques. La
différence est très minime entre données de base et celle standardisé
par dataset, la proportion de varance expliquée par la première
dimension est plus élevé dans le second cas alors que celles de la
deuxième et troisième plus faible.</p>
<pre class="r"><code># par(mfrow = c(3,2))
# plot(pca_results_li_stand_rm, axes = c(1, 2), choix=&quot;ind&quot;)
plot(pca_results_li_stand_rm, axes = c(1, 2), choix=&quot;var&quot;)</code></pre>
<p><img src="08_metaanalysis_files/figure-html/var_plot_pca_standardise-1.png" width="900" /></p>
<pre class="r"><code># plot(pca_results_li_stand_rm, axes = c(1, 3), choix=&quot;ind&quot;)
plot(pca_results_li_stand_rm, axes = c(1, 3), choix=&quot;var&quot;)</code></pre>
<p><img src="08_metaanalysis_files/figure-html/var_plot_pca_standardise-2.png" width="900" /></p>
<pre class="r"><code># plot(pca_results_li_stand_rm, axes = c(2, 3), choix=&quot;ind&quot;)
plot(pca_results_li_stand_rm, axes = c(2, 3), choix=&quot;var&quot;)</code></pre>
<p><img src="08_metaanalysis_files/figure-html/var_plot_pca_standardise-3.png" width="900" /></p>
<pre class="r"><code># par(mfrow = c(1,1))</code></pre>
<pre class="r"><code>dimdesc(pca_results_li_stand_rm)</code></pre>
<p>On a des axes bien plus séparé - Premier axe construit par l’ensemble
des variables (moins aitcison) - second axe construit uniquement par les
corrélations en lignes (types cell) - troisième axe construit uniquement
par aitchison On voit également que le score aggreg est quasiment
parfaitement corrélé au premier axes de cette PCA.</p>
<pre class="r"><code>plot_density_groups(res_pca = pca_results_li_stand_rm, axes = c(1,2))</code></pre>
<p><img src="08_metaanalysis_files/figure-html/new_plot_ellipses_standardise-1.png" width="900" /></p>
<pre class="r"><code>plot_density_groups(res_pca = pca_results_li_stand_rm, axes = c(1,3))</code></pre>
<p><img src="08_metaanalysis_files/figure-html/new_plot_ellipses_standardise-2.png" width="900" /></p>
<pre class="r"><code>plot_density_groups(res_pca = pca_results_li_stand_rm, axes = c(2,3))</code></pre>
<p><img src="08_metaanalysis_files/figure-html/new_plot_ellipses_standardise-3.png" width="900" /></p>
<p>Selon le graphique des axes 1 et 2, On retrouve des conclusions que
l’on a déjà pu avoir : - pour la deconvolution RNA, c’est RLR,
RLRpoisson et node (donc onlyMET) qui ont les valeurs moyennes les plus
grandes, donc les meilleurs resultats selon le score aggreg puisqu’il
est fortement corrélé à cette axe. - pour la deconvolution RNA, on voit
bien que node (donc Only RNA) a une valeur faible pour ce premier axe,
donc n’a pas de bon résultat pour le score aggreg. On retrouve ces
conclusions dans le graphique de late Integration</p>
<p>Pour les dimensions 2 et 3, cela nous donne de nouveau indices
concernant certaine méthode : - Les méthodes RLR et RLRpoisson ont
tendances à plus données des estimation à 0 que lm ou nnls - On voit un
différence sur la deuxième dimension entre RLR et RLRpoisson, donc la
seconde méthode donne des estimations avec un ordre des types
cellulaires globalement plus corrélée que la première - La meilleur
méthode d’intégration tardive liMeanRMSE a un coefficient faible pour la
seconde dimension de l’ACP, donc produit de bonne estimation globale des
proportions des types cellulaires mais ne donne pas le bonne ordre de
ceux-ci (puisque les corrélation vont de -1 à 1). Paradoxalement,
OnlyRNA ne donne pas de bonne estimatio mais le bonne ordre. - OnlyRNA
est la méthode d’integration tardives a une très forte valeur pour la
troisième dimension (cette modalité doit construire à elle seul cet
axe), donc OnlyRNA (soit les méthodes de déconvolution sur le
transcriptome) a tendance à produire beaucoup d’estimation à 0, puisque
c’est cela qui fait explosé la distance d’Aitchison qui est la seul
métrique fortement corrélé à cet axe. Cependant, OnlyMET est la seconde
valeur la plus forte donc on pourrait donner la même conclusions dans
une moindre mesure.</p>
<!--
- Les ACM c'est pour des variables quali, je ne pense pas que ce soit logique de faire ça dans notre ca
- Les AFP, c'est pour des tableaux de contingences avec des effectifs, donc ce n'est pas notre cas
-->
</div>
<div id="mfa" class="section level2" number="5.4">
<h2><span class="header-section-number">5.4</span> MFA</h2>
<pre class="r"><code>
score_results_li_rm_dtainvitro = results_li_rm[results_li_rm$dataset == &quot;invitro1&quot;, 16:ncol(results_li_rm)]
score_results_li_rm_dtaCopule = results_li_rm[results_li_rm$dataset == &quot;insilicodirichletCopule1&quot;, 16:ncol(results_li_rm)]
score_results_li_rm_dtaEMFA = results_li_rm[results_li_rm$dataset == &quot;insilicodirichletEMFA1&quot;, 16:ncol(results_li_rm)]
score_results_li_rm_dtapseudobulk = results_li_rm[results_li_rm$dataset == &quot;insilicopseudobulk1&quot;, 16:ncol(results_li_rm)]

score_aggreg_order = grep(&quot;score_aggreg&quot;, colnames(score_results_li_rm_dtainvitro))
normalised_metrics = grep(&quot;norm&quot;, colnames(score_results_li_rm_dtainvitro))
unnormalised_metrics = (1:ncol(score_results_li_rm_dtainvitro))[-c(score_aggreg_order, normalised_metrics)]

unnorm_score_results_li_rm_dtainvitro = score_results_li_rm_dtainvitro[,unnormalised_metrics]
unnorm_score_results_li_rm_dtaCopule = score_results_li_rm_dtaCopule[,unnormalised_metrics]
unnorm_score_results_li_rm_dtaEMFA = score_results_li_rm_dtaEMFA[,unnormalised_metrics]
unnorm_score_results_li_rm_dtapseudobulk = score_results_li_rm_dtapseudobulk[,unnormalised_metrics]

colnames(unnorm_score_results_li_rm_dtainvitro) = paste0(
  colnames(unnorm_score_results_li_rm_dtainvitro), 
  &quot;_invitro&quot;
)
colnames(unnorm_score_results_li_rm_dtaCopule) = paste0(
  colnames(unnorm_score_results_li_rm_dtaCopule), 
  &quot;_Copule&quot;
)
colnames(unnorm_score_results_li_rm_dtaEMFA) = paste0(
  colnames(unnorm_score_results_li_rm_dtaEMFA), 
  &quot;_EMFA&quot;
)
colnames(unnorm_score_results_li_rm_dtapseudobulk) = paste0(
  colnames(unnorm_score_results_li_rm_dtapseudobulk), 
  &quot;_pseudobulk&quot;
)

score_aggreg_results_li_all_dta = cbind(
  score_aggreg_invitro = score_results_li_rm_dtainvitro[,score_aggreg_order],
  score_aggreg_Copule = score_results_li_rm_dtaCopule[,score_aggreg_order],
  score_aggreg_EMFA = score_results_li_rm_dtaEMFA[,score_aggreg_order],
  score_aggreg_pseudobulk = score_results_li_rm_dtapseudobulk[,score_aggreg_order]
)


results_li_rm_MFA = cbind(
  results_li_rm[results_li_rm$dataset == &quot;invitro1&quot;, 3:15],
  score_aggreg_results_li_all_dta,
  unnorm_score_results_li_rm_dtainvitro,
  unnorm_score_results_li_rm_dtaCopule,
  unnorm_score_results_li_rm_dtaEMFA,
  unnorm_score_results_li_rm_dtapseudobulk
)

mfa_results_li_rm_MFA = MFA(results_li_rm_MFA, group = c(13, 4, rep(11, 4)), type = c(&quot;n&quot;, &quot;s&quot;, rep(&quot;s&quot;, 4)), name.group = c(&quot;method&quot;, &quot;score_aggreg&quot;, &quot;in vitro&quot;, &quot;Copule&quot;, &quot;EMFA&quot;, &quot;Pseudo bulk&quot;), num.group.sup = 1:2, graph = FALSE)
barplot(mfa_results_li_rm_MFA$eig[,2])
mfa_results_li_rm_MFA$eig[1:10,]</code></pre>
<p>Les 4 première composantes seront analysées, représentant 90.4% de la
variabilité des données</p>
<pre class="r"><code>round(mfa_results_li_rm_MFA$group$RV, 2)</code></pre>
<p>Ce graphique montre les coefficient RV qui varient entre 0 et 1. Ils
signifient le lien entre les groupes et entre l’AFM global. On observe
donc que le jeu de donnée le plus différent est “pseudo bulk”; “EMFA”,
“Copule” et “in vitro” ont quand à eu des représentation similaire, ce
qui les amène forcement à avoir une représentation similaire de l’AFM
globale. Cela indiquerai que nos simulation sont correct (puisqu’elle
reproduise bien le comportement des méthodes de déconv) ?</p>
<p>Pour score aggreg, ce group à très peu de lien avec method mais de
fort lien avec tout les autres (moins avec pseudo bulk) et surtout avec
l’AFM global. Cela vas dans le sens que le score aggreg que l’on a
construit est proche de la première dimension d’une ACP sur les
resulat</p>
<pre class="r"><code>plot(mfa_results_li_rm_MFA, axes = c(1,2), choix = &quot;group&quot;)
plot(mfa_results_li_rm_MFA, axes = c(2,3), choix = &quot;group&quot;)
plot(mfa_results_li_rm_MFA, axes = c(3,4), choix = &quot;group&quot;)</code></pre>
<p>La première dimension de l’AFM est commune au 4 jeu de donnée (la
plus grande valeur est pour le groupe des scores aggrégés). Cependant,
selon la deuxième dimension seul le dataset pseudo bulk différencie les
méthodes de déconvolution. La deuxième dimension de l’AFM est donc plus
liée à celle de ce dataset. Les troisième et quatrième dimensions ne
sont pas particulièrement liées à un dataset (légèrement pseudo bulk
pour la quatrième), mais permet cependant de décrire le groupe methode
qui contient les caractéristiques des méthodes de déconvolution
multi-omique utilisé, à l’inverse du groupe score aggrégé.</p>
<pre class="r"><code>plot(mfa_results_li_rm_MFA, axes = c(1,2), choix = &quot;var&quot;)
plot(mfa_results_li_rm_MFA, axes = c(2,3), choix = &quot;var&quot;)
plot(mfa_results_li_rm_MFA, axes = c(3,4), choix = &quot;var&quot;)</code></pre>
<p>On remarque bien pour les deux premier axes que les variables sont
quasi superposées pour les datasets “Copule”, “EMFA” et “in vitro”.</p>
<p>Les score aggreg sont très corrélé à la première dimension de l’AFM
(et donc de la première dimension des ACP par groupe) (un peu moins pour
le score aggreg de pseudo bulk mais celui si reste cohérent avec les
variables de pseudo bulk).</p>
<p>Le troisième axes est construit de manière unanime par la distance
d’aitchison, c’est sur le second et le quatrième qu’il y a différence
entre pseudo bulk et les autres dataset. Pour pseudo bulk, l’ensemble
des variables ne construisent pas que le premier axes mais les deux
premire, le troisième par aitchison et le quatrième par les corrélation
en lignes.</p>
<pre class="r"><code>plot(mfa_results_li_rm_MFA, axes = c(1,2), choix = &quot;axes&quot;)
plot(mfa_results_li_rm_MFA, axes = c(2,3), choix = &quot;axes&quot;)
plot(mfa_results_li_rm_MFA, axes = c(3,4), choix = &quot;axes&quot;)</code></pre>
<p>On voit bien ma réfléxion du paragraphe précédent sur la
représentatin des axes des ACP par groupes sur les axes de l’AFM.</p>
<pre class="r"><code>plot(mfa_results_li_rm_MFA, axes = c(1,2), choix = &quot;ind&quot;, invisible = &quot;ind&quot;)
plot(mfa_results_li_rm_MFA, axes = c(2,3), choix = &quot;ind&quot;, invisible = &quot;ind&quot;)
plot(mfa_results_li_rm_MFA, axes = c(3,4), choix = &quot;ind&quot;, invisible = &quot;ind&quot;)</code></pre>
<p>le point extreme c’est la méthode OnlyRNA (qui se superpose avec les
MetnoDE, METnoFS, <span class="math inline">\(\dots\)</span>). Je pense
que ce point fait gonfler le lien entre les dim 3 et 4 avec le groupe
methode. On voit bien dans la matrice du coef RV qu’il n’y a pas de
lien.</p>
</div>
<div id="mulidimensionnal-scaling-mds" class="section level2"
number="5.5">
<h2><span class="header-section-number">5.5</span> Mulidimensionnal
scaling (MDS)</h2>
<p>Pour faire une MDS, il faut faire la matrice de
distance/dissimilarité entre tout les individus. Cela devient compliquer
quand il y en a plus de 100000 comme dans notre cas (objet d’environ 50
Go).</p>
</div>
</div>
<div id="old" class="section level1" number="6">
<h1><span class="header-section-number">6</span> Old</h1>
<div id="nico-test-visu-gpt" class="section level2" number="6.1">
<h2><span class="header-section-number">6.1</span> Nico test visu
(GPT…)</h2>
<pre class="r"><code>multi_level_cols &lt;- sapply(results_li[all_functions_li], function(x) nlevels(x) &gt; 1)
filtered_functions &lt;- all_functions_li[multi_level_cols]
dropped_cols &lt;- all_functions_li[!multi_level_cols]
cat(&quot;Dropped columns (only 1 level):&quot;, paste(dropped_cols, collapse = &quot;, &quot;), &quot;\n&quot;)
</code></pre>
<pre class="r"><code>
# Now run the model
model &lt;- lm(score_aggreg ~ ., data = results_li[, c(filtered_functions, &quot;score_aggreg&quot;)])
summary(model)
</code></pre>
<pre class="r"><code>anova_results &lt;- anova(model)
anova_results &lt;- anova_results[order(-anova_results$`Sum Sq`), ]
print(anova_results)</code></pre>
<pre class="r"><code># Get coefficients sorted by value
coefs &lt;- coef(model)
coefs &lt;- coefs[!grepl(&quot;(Intercept)&quot;, names(coefs))]
coefs_sorted &lt;- sort(coefs, decreasing = TRUE)

# Top positive and negative functions
head(coefs_sorted, 10)  # most positive
tail(coefs_sorted, 10)  # most negative
</code></pre>
<pre class="r"><code># Load required package
library(fastDummies)

# Use only multi-level function columns (from before)
df_pca &lt;- results_li[, c(filtered_functions, &quot;score_aggreg&quot;)]

# One-hot encode the factor columns
df_pca_encoded &lt;- dummy_cols(df_pca, select_columns = filtered_functions, remove_first_dummy = TRUE, remove_selected_columns = TRUE)
</code></pre>
<pre class="r"><code># Run PCA on all features (excluding score_aggreg)
pca_result &lt;- prcomp(df_pca_encoded[, !colnames(df_pca_encoded) %in% &quot;score_aggreg&quot;], center = TRUE, scale. = TRUE)

# View explained variance
summary(pca_result)

# Scree plot
plot(pca_result, type = &quot;l&quot;, main = &quot;Scree Plot&quot;)
</code></pre>
<pre class="r"><code># Use ggplot2 for PCA biplot with color = score_aggreg
library(ggplot2)

# Extract PCA coordinates
pca_data &lt;- as.data.frame(pca_result$x)
pca_data$score_aggreg &lt;- df_pca_encoded$score_aggreg

# ggplot(pca_data, aes(x = PC1, y = PC2, color = score_aggreg)) +
#   geom_point(size = 3) +
#   scale_color_gradient(low = &quot;blue&quot;, high = &quot;red&quot;) +
#   theme_minimal() +
#   labs(title = &quot;PCA of Function Combinations Colored by score_aggreg&quot;)

  ggplot(pca_data, aes(x = PC1, y = score_aggreg)) +
  geom_point(size = 3, color = &quot;steelblue&quot;) +
  theme_minimal() +
  labs(title = &quot;PC1 vs score_aggreg&quot;)
</code></pre>
<pre class="r"><code># Get the proportion of variance explained
explained_var &lt;- summary(pca_result)$importance[&quot;Proportion of Variance&quot;, ]

meaningful_pcs &lt;- names(explained_var[explained_var &gt; 0])

n_pcs_to_show &lt;- min(length(meaningful_pcs), 3)
meaningful_pcs &lt;- meaningful_pcs[1:n_pcs_to_show]


for (pc in meaningful_pcs) {
  cat(&quot;\nTop contributing variables to&quot;, pc, &quot;:\n&quot;)
  loadings &lt;- sort(abs(pca_result$rotation[, pc]), decreasing = TRUE)
  print(head(loadings, 10))
}

if (length(meaningful_pcs) == 0) {
  cat(&quot;No meaningful principal components found (explained variance is zero).&quot;)
}</code></pre>
</div>
<div id="florents-pca" class="section level2" number="6.2">
<h2><span class="header-section-number">6.2</span> Florent’s pca</h2>
<pre class="r"><code># results_li = read.table(&quot;metaanalysis/results_li.csv&quot;, sep=&quot;,&quot;, header=TRUE)
foo = sapply(colnames(results_li), function(k) {
  print(paste0(k, &quot; &quot;, is.numeric(results_li[,k])))
  is.numeric(results_li[,k])
})
#&gt; [1] &quot;dataset FALSE&quot;
#&gt; [1] &quot;ref FALSE&quot;
#&gt; [1] &quot;preprocessing_mixRNA FALSE&quot;
#&gt; [1] &quot;feature_selection_mixRNA FALSE&quot;
#&gt; [1] &quot;preprocessing_RNA FALSE&quot;
#&gt; [1] &quot;feature_selection_RNA FALSE&quot;
#&gt; [1] &quot;preprocessing_scRNA FALSE&quot;
#&gt; [1] &quot;feature_selection_scRNA FALSE&quot;
#&gt; [1] &quot;deconvolution_rna FALSE&quot;
#&gt; [1] &quot;preprocessing_mixMET FALSE&quot;
#&gt; [1] &quot;feature_selection_mixMET FALSE&quot;
#&gt; [1] &quot;preprocessing_MET FALSE&quot;
#&gt; [1] &quot;feature_selection_MET FALSE&quot;
#&gt; [1] &quot;deconvolution_met FALSE&quot;
#&gt; [1] &quot;late_integration FALSE&quot;
#&gt; [1] &quot;aid TRUE&quot;
#&gt; [1] &quot;aid_norm TRUE&quot;
#&gt; [1] &quot;aitchison TRUE&quot;
#&gt; [1] &quot;aitchison_norm TRUE&quot;
#&gt; [1] &quot;jsd TRUE&quot;
#&gt; [1] &quot;jsd_norm TRUE&quot;
#&gt; [1] &quot;mae TRUE&quot;
#&gt; [1] &quot;mae_norm TRUE&quot;
#&gt; [1] &quot;pearson_col TRUE&quot;
#&gt; [1] &quot;pearson_col_norm TRUE&quot;
#&gt; [1] &quot;pearson_row TRUE&quot;
#&gt; [1] &quot;pearson_row_norm TRUE&quot;
#&gt; [1] &quot;pearson_tot TRUE&quot;
#&gt; [1] &quot;pearson_tot_norm TRUE&quot;
#&gt; [1] &quot;rmse TRUE&quot;
#&gt; [1] &quot;rmse_norm TRUE&quot;
#&gt; [1] &quot;score_aggreg TRUE&quot;
#&gt; [1] &quot;sdid TRUE&quot;
#&gt; [1] &quot;sdid_norm TRUE&quot;
#&gt; [1] &quot;spearman_col TRUE&quot;
#&gt; [1] &quot;spearman_col_norm TRUE&quot;
#&gt; [1] &quot;spearman_row TRUE&quot;
#&gt; [1] &quot;spearman_row_norm TRUE&quot;
#&gt; [1] &quot;spearman_tot TRUE&quot;
#&gt; [1] &quot;spearman_tot_norm TRUE&quot;
keys = colnames(results_li)[foo]
data = as.matrix(results_li[,keys])
head(data)[,1:10]
#&gt;                                                                                                                                                                             aid
#&gt; score-li-insilicopseudobulk2_ref_mixRNA_LogNorm_Toastvst_RNA_LogNorm_Toastvst_scRNA_LogNorm_Toastvst_RLR_mixMET_LogNorm_SPLSDA_MET_LogNorm_SPLSDA_RLR_limean.h5        24.52369
#&gt; score-li-insilicopseudobulk2_ref_mixRNA_LogNorm_Toastvst_RNA_LogNorm_Toastvst_scRNA_LogNorm_Toastvst_RLR_mixMET_LogNorm_SPLSDA_MET_LogNorm_SPLSDA_RLRpoisson_limean.h5 24.75130
#&gt; score-li-insilicopseudobulk2_ref_mixRNA_LogNorm_Toastvst_RNA_LogNorm_Toastvst_scRNA_LogNorm_Toastvst_RLR_mixMET_LogNorm_SPLSDA_MET_LogNorm_SPLSDA_nnls_limean.h5       25.25561
#&gt; score-li-insilicopseudobulk2_ref_mixRNA_LogNorm_Toastvst_RNA_LogNorm_Toastvst_scRNA_LogNorm_Toastvst_RLR_mixMET_LogNorm_fsID_MET_LogNorm_fsID_RLR_limean.h5            23.55247
#&gt; score-li-insilicopseudobulk2_ref_mixRNA_LogNorm_Toastvst_RNA_LogNorm_Toastvst_scRNA_LogNorm_Toastvst_RLR_mixMET_LogNorm_fsID_MET_LogNorm_fsID_RLRpoisson_limean.h5     24.51772
#&gt; score-li-insilicopseudobulk2_ref_mixRNA_LogNorm_Toastvst_RNA_LogNorm_Toastvst_scRNA_LogNorm_Toastvst_RLR_mixMET_LogNorm_fsID_MET_LogNorm_fsID_nnls_limean.h5           25.00983
#&gt;                                                                                                                                                                         aid_norm
#&gt; score-li-insilicopseudobulk2_ref_mixRNA_LogNorm_Toastvst_RNA_LogNorm_Toastvst_scRNA_LogNorm_Toastvst_RLR_mixMET_LogNorm_SPLSDA_MET_LogNorm_SPLSDA_RLR_limean.h5        0.7275145
#&gt; score-li-insilicopseudobulk2_ref_mixRNA_LogNorm_Toastvst_RNA_LogNorm_Toastvst_scRNA_LogNorm_Toastvst_RLR_mixMET_LogNorm_SPLSDA_MET_LogNorm_SPLSDA_RLRpoisson_limean.h5 0.7249856
#&gt; score-li-insilicopseudobulk2_ref_mixRNA_LogNorm_Toastvst_RNA_LogNorm_Toastvst_scRNA_LogNorm_Toastvst_RLR_mixMET_LogNorm_SPLSDA_MET_LogNorm_SPLSDA_nnls_limean.h5       0.7193821
#&gt; score-li-insilicopseudobulk2_ref_mixRNA_LogNorm_Toastvst_RNA_LogNorm_Toastvst_scRNA_LogNorm_Toastvst_RLR_mixMET_LogNorm_fsID_MET_LogNorm_fsID_RLR_limean.h5            0.7383059
#&gt; score-li-insilicopseudobulk2_ref_mixRNA_LogNorm_Toastvst_RNA_LogNorm_Toastvst_scRNA_LogNorm_Toastvst_RLR_mixMET_LogNorm_fsID_MET_LogNorm_fsID_RLRpoisson_limean.h5     0.7275809
#&gt; score-li-insilicopseudobulk2_ref_mixRNA_LogNorm_Toastvst_RNA_LogNorm_Toastvst_scRNA_LogNorm_Toastvst_RLR_mixMET_LogNorm_fsID_MET_LogNorm_fsID_nnls_limean.h5           0.7221131
#&gt;                                                                                                                                                                        aitchison
#&gt; score-li-insilicopseudobulk2_ref_mixRNA_LogNorm_Toastvst_RNA_LogNorm_Toastvst_scRNA_LogNorm_Toastvst_RLR_mixMET_LogNorm_SPLSDA_MET_LogNorm_SPLSDA_RLR_limean.h5         4.149124
#&gt; score-li-insilicopseudobulk2_ref_mixRNA_LogNorm_Toastvst_RNA_LogNorm_Toastvst_scRNA_LogNorm_Toastvst_RLR_mixMET_LogNorm_SPLSDA_MET_LogNorm_SPLSDA_RLRpoisson_limean.h5  4.184362
#&gt; score-li-insilicopseudobulk2_ref_mixRNA_LogNorm_Toastvst_RNA_LogNorm_Toastvst_scRNA_LogNorm_Toastvst_RLR_mixMET_LogNorm_SPLSDA_MET_LogNorm_SPLSDA_nnls_limean.h5        4.276354
#&gt; score-li-insilicopseudobulk2_ref_mixRNA_LogNorm_Toastvst_RNA_LogNorm_Toastvst_scRNA_LogNorm_Toastvst_RLR_mixMET_LogNorm_fsID_MET_LogNorm_fsID_RLR_limean.h5             4.168544
#&gt; score-li-insilicopseudobulk2_ref_mixRNA_LogNorm_Toastvst_RNA_LogNorm_Toastvst_scRNA_LogNorm_Toastvst_RLR_mixMET_LogNorm_fsID_MET_LogNorm_fsID_RLRpoisson_limean.h5      4.217273
#&gt; score-li-insilicopseudobulk2_ref_mixRNA_LogNorm_Toastvst_RNA_LogNorm_Toastvst_scRNA_LogNorm_Toastvst_RLR_mixMET_LogNorm_fsID_MET_LogNorm_fsID_nnls_limean.h5            4.252829
#&gt;                                                                                                                                                                        aitchison_norm
#&gt; score-li-insilicopseudobulk2_ref_mixRNA_LogNorm_Toastvst_RNA_LogNorm_Toastvst_scRNA_LogNorm_Toastvst_RLR_mixMET_LogNorm_SPLSDA_MET_LogNorm_SPLSDA_RLR_limean.h5             0.8141369
#&gt; score-li-insilicopseudobulk2_ref_mixRNA_LogNorm_Toastvst_RNA_LogNorm_Toastvst_scRNA_LogNorm_Toastvst_RLR_mixMET_LogNorm_SPLSDA_MET_LogNorm_SPLSDA_RLRpoisson_limean.h5      0.8125584
#&gt; score-li-insilicopseudobulk2_ref_mixRNA_LogNorm_Toastvst_RNA_LogNorm_Toastvst_scRNA_LogNorm_Toastvst_RLR_mixMET_LogNorm_SPLSDA_MET_LogNorm_SPLSDA_nnls_limean.h5            0.8084375
#&gt; score-li-insilicopseudobulk2_ref_mixRNA_LogNorm_Toastvst_RNA_LogNorm_Toastvst_scRNA_LogNorm_Toastvst_RLR_mixMET_LogNorm_fsID_MET_LogNorm_fsID_RLR_limean.h5                 0.8132670
#&gt; score-li-insilicopseudobulk2_ref_mixRNA_LogNorm_Toastvst_RNA_LogNorm_Toastvst_scRNA_LogNorm_Toastvst_RLR_mixMET_LogNorm_fsID_MET_LogNorm_fsID_RLRpoisson_limean.h5          0.8110841
#&gt; score-li-insilicopseudobulk2_ref_mixRNA_LogNorm_Toastvst_RNA_LogNorm_Toastvst_scRNA_LogNorm_Toastvst_RLR_mixMET_LogNorm_fsID_MET_LogNorm_fsID_nnls_limean.h5                0.8094913
#&gt;                                                                                                                                                                               jsd
#&gt; score-li-insilicopseudobulk2_ref_mixRNA_LogNorm_Toastvst_RNA_LogNorm_Toastvst_scRNA_LogNorm_Toastvst_RLR_mixMET_LogNorm_SPLSDA_MET_LogNorm_SPLSDA_RLR_limean.h5        0.06034581
#&gt; score-li-insilicopseudobulk2_ref_mixRNA_LogNorm_Toastvst_RNA_LogNorm_Toastvst_scRNA_LogNorm_Toastvst_RLR_mixMET_LogNorm_SPLSDA_MET_LogNorm_SPLSDA_RLRpoisson_limean.h5 0.06098786
#&gt; score-li-insilicopseudobulk2_ref_mixRNA_LogNorm_Toastvst_RNA_LogNorm_Toastvst_scRNA_LogNorm_Toastvst_RLR_mixMET_LogNorm_SPLSDA_MET_LogNorm_SPLSDA_nnls_limean.h5       0.06432501
#&gt; score-li-insilicopseudobulk2_ref_mixRNA_LogNorm_Toastvst_RNA_LogNorm_Toastvst_scRNA_LogNorm_Toastvst_RLR_mixMET_LogNorm_fsID_MET_LogNorm_fsID_RLR_limean.h5            0.05834091
#&gt; score-li-insilicopseudobulk2_ref_mixRNA_LogNorm_Toastvst_RNA_LogNorm_Toastvst_scRNA_LogNorm_Toastvst_RLR_mixMET_LogNorm_fsID_MET_LogNorm_fsID_RLRpoisson_limean.h5     0.06179560
#&gt; score-li-insilicopseudobulk2_ref_mixRNA_LogNorm_Toastvst_RNA_LogNorm_Toastvst_scRNA_LogNorm_Toastvst_RLR_mixMET_LogNorm_fsID_MET_LogNorm_fsID_nnls_limean.h5           0.06392294
#&gt;                                                                                                                                                                         jsd_norm
#&gt; score-li-insilicopseudobulk2_ref_mixRNA_LogNorm_Toastvst_RNA_LogNorm_Toastvst_scRNA_LogNorm_Toastvst_RLR_mixMET_LogNorm_SPLSDA_MET_LogNorm_SPLSDA_RLR_limean.h5        0.9074017
#&gt; score-li-insilicopseudobulk2_ref_mixRNA_LogNorm_Toastvst_RNA_LogNorm_Toastvst_scRNA_LogNorm_Toastvst_RLR_mixMET_LogNorm_SPLSDA_MET_LogNorm_SPLSDA_RLRpoisson_limean.h5 0.9064165
#&gt; score-li-insilicopseudobulk2_ref_mixRNA_LogNorm_Toastvst_RNA_LogNorm_Toastvst_scRNA_LogNorm_Toastvst_RLR_mixMET_LogNorm_SPLSDA_MET_LogNorm_SPLSDA_nnls_limean.h5       0.9012957
#&gt; score-li-insilicopseudobulk2_ref_mixRNA_LogNorm_Toastvst_RNA_LogNorm_Toastvst_scRNA_LogNorm_Toastvst_RLR_mixMET_LogNorm_fsID_MET_LogNorm_fsID_RLR_limean.h5            0.9104781
#&gt; score-li-insilicopseudobulk2_ref_mixRNA_LogNorm_Toastvst_RNA_LogNorm_Toastvst_scRNA_LogNorm_Toastvst_RLR_mixMET_LogNorm_fsID_MET_LogNorm_fsID_RLRpoisson_limean.h5     0.9051770
#&gt; score-li-insilicopseudobulk2_ref_mixRNA_LogNorm_Toastvst_RNA_LogNorm_Toastvst_scRNA_LogNorm_Toastvst_RLR_mixMET_LogNorm_fsID_MET_LogNorm_fsID_nnls_limean.h5           0.9019127
#&gt;                                                                                                                                                                               mae
#&gt; score-li-insilicopseudobulk2_ref_mixRNA_LogNorm_Toastvst_RNA_LogNorm_Toastvst_scRNA_LogNorm_Toastvst_RLR_mixMET_LogNorm_SPLSDA_MET_LogNorm_SPLSDA_RLR_limean.h5        0.09783022
#&gt; score-li-insilicopseudobulk2_ref_mixRNA_LogNorm_Toastvst_RNA_LogNorm_Toastvst_scRNA_LogNorm_Toastvst_RLR_mixMET_LogNorm_SPLSDA_MET_LogNorm_SPLSDA_RLRpoisson_limean.h5 0.09973300
#&gt; score-li-insilicopseudobulk2_ref_mixRNA_LogNorm_Toastvst_RNA_LogNorm_Toastvst_scRNA_LogNorm_Toastvst_RLR_mixMET_LogNorm_SPLSDA_MET_LogNorm_SPLSDA_nnls_limean.h5       0.10138509
#&gt; score-li-insilicopseudobulk2_ref_mixRNA_LogNorm_Toastvst_RNA_LogNorm_Toastvst_scRNA_LogNorm_Toastvst_RLR_mixMET_LogNorm_fsID_MET_LogNorm_fsID_RLR_limean.h5            0.09230398
#&gt; score-li-insilicopseudobulk2_ref_mixRNA_LogNorm_Toastvst_RNA_LogNorm_Toastvst_scRNA_LogNorm_Toastvst_RLR_mixMET_LogNorm_fsID_MET_LogNorm_fsID_RLRpoisson_limean.h5     0.09661437
#&gt; score-li-insilicopseudobulk2_ref_mixRNA_LogNorm_Toastvst_RNA_LogNorm_Toastvst_scRNA_LogNorm_Toastvst_RLR_mixMET_LogNorm_fsID_MET_LogNorm_fsID_nnls_limean.h5           0.09853047
#&gt;                                                                                                                                                                         mae_norm
#&gt; score-li-insilicopseudobulk2_ref_mixRNA_LogNorm_Toastvst_RNA_LogNorm_Toastvst_scRNA_LogNorm_Toastvst_RLR_mixMET_LogNorm_SPLSDA_MET_LogNorm_SPLSDA_RLR_limean.h5        0.7506139
#&gt; score-li-insilicopseudobulk2_ref_mixRNA_LogNorm_Toastvst_RNA_LogNorm_Toastvst_scRNA_LogNorm_Toastvst_RLR_mixMET_LogNorm_SPLSDA_MET_LogNorm_SPLSDA_RLRpoisson_limean.h5 0.7457634
#&gt; score-li-insilicopseudobulk2_ref_mixRNA_LogNorm_Toastvst_RNA_LogNorm_Toastvst_scRNA_LogNorm_Toastvst_RLR_mixMET_LogNorm_SPLSDA_MET_LogNorm_SPLSDA_nnls_limean.h5       0.7415519
#&gt; score-li-insilicopseudobulk2_ref_mixRNA_LogNorm_Toastvst_RNA_LogNorm_Toastvst_scRNA_LogNorm_Toastvst_RLR_mixMET_LogNorm_fsID_MET_LogNorm_fsID_RLR_limean.h5            0.7647012
#&gt; score-li-insilicopseudobulk2_ref_mixRNA_LogNorm_Toastvst_RNA_LogNorm_Toastvst_scRNA_LogNorm_Toastvst_RLR_mixMET_LogNorm_fsID_MET_LogNorm_fsID_RLRpoisson_limean.h5     0.7537133
#&gt; score-li-insilicopseudobulk2_ref_mixRNA_LogNorm_Toastvst_RNA_LogNorm_Toastvst_scRNA_LogNorm_Toastvst_RLR_mixMET_LogNorm_fsID_MET_LogNorm_fsID_nnls_limean.h5           0.7488288
#&gt;                                                                                                                                                                        pearson_col
#&gt; score-li-insilicopseudobulk2_ref_mixRNA_LogNorm_Toastvst_RNA_LogNorm_Toastvst_scRNA_LogNorm_Toastvst_RLR_mixMET_LogNorm_SPLSDA_MET_LogNorm_SPLSDA_RLR_limean.h5          0.6600707
#&gt; score-li-insilicopseudobulk2_ref_mixRNA_LogNorm_Toastvst_RNA_LogNorm_Toastvst_scRNA_LogNorm_Toastvst_RLR_mixMET_LogNorm_SPLSDA_MET_LogNorm_SPLSDA_RLRpoisson_limean.h5   0.6503604
#&gt; score-li-insilicopseudobulk2_ref_mixRNA_LogNorm_Toastvst_RNA_LogNorm_Toastvst_scRNA_LogNorm_Toastvst_RLR_mixMET_LogNorm_SPLSDA_MET_LogNorm_SPLSDA_nnls_limean.h5         0.6425003
#&gt; score-li-insilicopseudobulk2_ref_mixRNA_LogNorm_Toastvst_RNA_LogNorm_Toastvst_scRNA_LogNorm_Toastvst_RLR_mixMET_LogNorm_fsID_MET_LogNorm_fsID_RLR_limean.h5              0.6823402
#&gt; score-li-insilicopseudobulk2_ref_mixRNA_LogNorm_Toastvst_RNA_LogNorm_Toastvst_scRNA_LogNorm_Toastvst_RLR_mixMET_LogNorm_fsID_MET_LogNorm_fsID_RLRpoisson_limean.h5       0.6634247
#&gt; score-li-insilicopseudobulk2_ref_mixRNA_LogNorm_Toastvst_RNA_LogNorm_Toastvst_scRNA_LogNorm_Toastvst_RLR_mixMET_LogNorm_fsID_MET_LogNorm_fsID_nnls_limean.h5             0.6536037
#&gt;                                                                                                                                                                        pearson_col_norm
#&gt; score-li-insilicopseudobulk2_ref_mixRNA_LogNorm_Toastvst_RNA_LogNorm_Toastvst_scRNA_LogNorm_Toastvst_RLR_mixMET_LogNorm_SPLSDA_MET_LogNorm_SPLSDA_RLR_limean.h5               0.8300353
#&gt; score-li-insilicopseudobulk2_ref_mixRNA_LogNorm_Toastvst_RNA_LogNorm_Toastvst_scRNA_LogNorm_Toastvst_RLR_mixMET_LogNorm_SPLSDA_MET_LogNorm_SPLSDA_RLRpoisson_limean.h5        0.8251802
#&gt; score-li-insilicopseudobulk2_ref_mixRNA_LogNorm_Toastvst_RNA_LogNorm_Toastvst_scRNA_LogNorm_Toastvst_RLR_mixMET_LogNorm_SPLSDA_MET_LogNorm_SPLSDA_nnls_limean.h5              0.8212501
#&gt; score-li-insilicopseudobulk2_ref_mixRNA_LogNorm_Toastvst_RNA_LogNorm_Toastvst_scRNA_LogNorm_Toastvst_RLR_mixMET_LogNorm_fsID_MET_LogNorm_fsID_RLR_limean.h5                   0.8411701
#&gt; score-li-insilicopseudobulk2_ref_mixRNA_LogNorm_Toastvst_RNA_LogNorm_Toastvst_scRNA_LogNorm_Toastvst_RLR_mixMET_LogNorm_fsID_MET_LogNorm_fsID_RLRpoisson_limean.h5            0.8317123
#&gt; score-li-insilicopseudobulk2_ref_mixRNA_LogNorm_Toastvst_RNA_LogNorm_Toastvst_scRNA_LogNorm_Toastvst_RLR_mixMET_LogNorm_fsID_MET_LogNorm_fsID_nnls_limean.h5                  0.8268018
# remove NA
table(apply(is.na(data), 2, sum))
#&gt; 
#&gt;    0 2592 7776 
#&gt;    5   18    2
data = data[,apply(!is.na(data), 2, all)]
table(apply(is.na(data), 2, sum))
#&gt; 
#&gt; 0 
#&gt; 5
pca = prcomp(data, scale=TRUE)
v = pca$sdev * pca$sdev
p = v / sum(v) * 100
names(p) = paste0(&quot;PC&quot;, 1:length(p))

pc_max = length(p)
cols = 1
layout(matrix(1:8, 2, byrow=FALSE), respect=TRUE)
barplot(p[1:pc_max], main=&quot;% of expl. var.&quot;, las=2)
# i=1
n_pcs &lt;- min(6, ncol(pca$x) - 1)
for (i in 1:n_pcs) {
  j &lt;- i + 1
  plot(
    pca$x[, i], pca$x[, j],
    xlab = paste0(&quot;PC&quot;, i, &quot; (&quot;, signif(p[i], 3), &quot;%)&quot;),
    ylab = paste0(&quot;PC&quot;, j, &quot; (&quot;, signif(p[j], 3), &quot;%)&quot;),
    col = adjustcolor(cols, alpha.f = 0.3), pch = 16
  )
}

# plot.new()
# legend(&quot;topright&quot;, levels(s$exp_grp$tissue), pch=16, col=1:length(levels(s$exp_grp$tissue)))</code></pre>
<p><img src="08_metaanalysis_files/figure-html/pca%20-1.png" width="900" /></p>
</div>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->

<script>
$(document).ready(function ()  {

    // temporarily add toc-ignore selector to headers for the consistency with Pandoc
    $('.unlisted.unnumbered').addClass('toc-ignore')

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_');
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
